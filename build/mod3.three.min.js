/**
*
*   MOD3.js
*   @version: 0.4
*   @dependencies: Classy.js
*
*   MOD3 3D Modifier Library for JavaScript 
*   port of AS3DMod ActionScript3 library (http://code.google.com/p/as3dmod/)
*   https://github.com/foo123/MOD3
*
**/!function(t,i,s,e,n){s=s?[].concat(s):[];var r,h,o=Array,u=o.prototype,a=s.length,l=new o(a);if("object"==typeof module&&module.exports){if(n===module.exports[i]){for(r=0;a>r;r++)l[r]=module.exports[s[r][0]]||require(s[r][1])[s[r][0]];h=e.apply(t,l),module.exports[i]=h||1}}else if("function"==typeof define&&define.amd)define(["exports"].concat(s.map(function(t){return t[1]})),function(r){if(n===r[i]){var o,a=u.slice.call(arguments,1),c=a.length;for(o=0;c>o;o++)l[o]=r[s[o][0]]||a[o];h=e.apply(t,l),r[i]=h||1}});else if(n===t[i]){for(r=0;a>r;r++)l[r]=t[s[r][0]];h=e.apply(t,l),t[i]=h||1}}(this,"MOD3",[["Classy","./classy"]],function(t){var i=i||{VERSION:"0.4",Class:t.Class,StaticClass:t.Static};return function(t){"use strict";t.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:.5*Math.PI,doublePI:2*Math.PI,toRad:Math.PI/180,toDeg:180/Math.PI},t.ModConstant={NONE:0,LEFT:-1,RIGHT:1,X:1,Y:2,Z:4,Xi:0,Yi:1,Zi:2},t.Array32F="undefined"!=typeof Float32Array?Float32Array:Array,t.Array64F="undefined"!=typeof Float64Array?Float64Array:Array,t.Array8I="undefined"!=typeof Int8Array?Int8Array:Array,t.Array16I="undefined"!=typeof Int16Array?Int16Array:Array,t.Array32I="undefined"!=typeof Int32Array?Int32Array:Array,t.Array8U="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Array16U="undefined"!=typeof Uint16Array?Uint16Array:Array,t.Array32U="undefined"!=typeof Uint32Array?Uint32Array:Array,t.VecArray=t.Array32F}(i),!function(t,i){var s=Object.prototype,e=Function.prototype,n=Array.prototype,r=e.call.bind(n.slice),h=e.call.bind(s.toString),o="undefined"!=typeof global&&"[object global]"===h(global),u=!o&&"undefined"!=typeof navigator,a="function"==typeof importScripts&&navigator instanceof WorkerNavigator,l="function"==typeof Worker;if(i.supportsWorker=l,i.getPath=function(){var t,i=null;return o?{path:__dirname,file:__filename}:(a?i=self.location.href:u&&(t=document.getElementsByTagName("script"))&&t.length&&(i=t[t.length-1].src),i?{path:i.split("/").slice(0,-1).join("/"),file:""+i}:{path:null,file:null})},a){var c=null;t.console={log:function(t){postMessage({event:"console.log",data:{output:t||""}})},error:function(t){postMessage({event:"console.error",data:{output:t||""}})}},onmessage=function(t){var s=t.data.event,e=t.data.data||null;switch(s){case"init":c&&(c.dispose(),c=null),e&&e.modifier&&i[e.modifier]&&(c=new i[e.modifier]);break;case"import":e&&e["import"]&&e["import"].length&&importScripts(e["import"].join(","));break;case"apply":c&&(e&&e.modifiable&&c.setModifiable(i.MeshProxy.unserialize(e.modifiable)),c.send("apply",{modifiable:c._apply().mod}));break;case"dispose":default:c&&(c.dispose(),c=null),close()}}}i.WorkerInterface=i.Class({path:i.getPath(),name:null,_worker:null,_workerListeners:null,disposeWorker:function(){var t=this;return t._worker&&(t.send("dispose"),t._worker=null,t._workerListeners=null),t},scripts:function(){var t=r(arguments);return t.length&&this.send("import",{"import":t}),this},worker:function(t){var i,s=this;if(arguments.length||(t=!0),t=!!t,!1===t)return s._worker&&s.disposeWorker(),s;if(!s._worker){if(!l)throw new Error("Worker is not supported");s._workerListeners={},i=s._worker=new Worker(this.path.file),i.onmessage=function(t){if(t.data.event){var i=t.data.event,e=t.data.data||null;s._workerListeners&&s._workerListeners[i]&&s._workerListeners[i](e),("console.log"===i||"console.error"===i)&&log("Worker: "+e.output)}},i.onerror=function(t){if(!s._workerListeners||!s._workerListeners.error)throw new Error("Worker Error: "+t.message+" file: "+t.filename+" line: "+t.lineno);s._workerListeners.error(t)},s.send("init",{modifier:s.name})}return s},bind:function(t,i){return t&&i&&this._workerListeners&&(this._workerListeners[t]=i.bind(this)),this},unbind:function(t){return t&&this._workerListeners&&this._workerListeners[t]&&delete this._workerListeners[t],this},send:function(t,i){return t&&(a?postMessage({event:t,data:i||null}):this._worker&&this._worker.postMessage({event:t,data:i||null})),this}})}(this,i),function(t,i){"use strict";var s,e=t.Constants.toRad,n=t.Constants.toDeg,r=Math.min,h=Math.max,o=Math.pow,u=Math.round,a=Math.florr,l=Math.ceil,c=t.XMath=t.StaticClass({normalize:function(t,i,e){var n,r=i-t;return n=0===r?1:s(0,1,(e-t)/i)},toRange:function(t,i,s){var e,n=i-t;return e=0===n?0:t+(i-t)*s},inRange:function(t,s,e,n){return n===i&&(n=!1),n?e>=t&&s>=e:e>t&&s>e},sign:function(t,s){return s===i&&(s=0),0==t?s:t>0?1:-1},trim:function(t,i,s){return r(i,h(t,s))},wrap:function(t,i,s){var e=i-t;return t>s?s+e:s>=i?s-e:s},degToRad:function(t){return t*e},radToDeg:function(t){return t*n},presicion:function(t,i){var s=o(10,i);return u(t*s)/s},uceil:function(t){return 0>t?a(t):l(t)}});s=c.clamp=c.trim}(i),function(t,i){"use strict";var s=t.XMath.normalize,e=t.XMath.toRange,n=t.XMath.trim;t.Range=t.Class(Object,{constructor:function(t,s){this.start=0,this.end=1,t!==i&&(this.start=t),s!==i&&(this.end=s)},start:0,end:1,dispose:function(){return this.start=null,this.end=null,this},getSize:function(){return this.end-this.start},move:function(t){this.start+=t,this.end+=t},isIn:function(t){return t>=this.start&&t<=this.end},normalize:function(t){return s(this.start,this.end,t)},toRange:function(t){return e(this.start,this.end,t)},trim:function(t){return n(this.start,this.end,t)},interpolate:function(t,i){return e(this.start,this.end,i.normalize(t))},toString:function(){return"["+this.start+" - "+this.end+"]"}})}(i),function(t,i){"use strict";var s=Math.sin,e=Math.abs;t.Phase=t.Class(Object,{constructor:function(t){this.value=0,t!==i&&(this.value=t)},value:0,dispose:function(){return this.value=null,this},getPhasedValue:function(){return s(this.value)},getAbsPhasedValue:function(){return e(s(this.value))},getNormValue:function(){return.5*(s(this.value)+1)}})}(i),!function(t,i){"use strict";var s=t.Point=t.Class({constructor:function(t,s){this.x=t===i?0:t,this.y=s===i?0:s},x:0,y:0,dispose:function(){return this.x=null,this.y=null,this},clone:function(){return new s(this.x,this.y)}})}(i),!function(t,i){"use strict";var s=Math.sin,e=Math.cos,n=t.Point,r=t.Matrix=t.Class({constructor:function(t,s,e,n){this.m11=t===i?1:t,this.m12=s===i?0:s,this.m21=e===i?0:e,this.m22=n===i?1:n},m11:1,m12:0,m21:0,m22:1,dispose:function(){return this.m11=null,this.m12=null,this.m21=null,this.m22=null,this},reset:function(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this},rotate:function(t){var i=e(t),n=s(t);return this.m11=i,this.m12=-n,this.m21=n,this.m22=i,this},scale:function(t,s){return this.m12=0,this.m21=0,this.m11=1,this.m22=1,t!==i&&(this.m11=t,this.m22=t),s!==i&&(this.m22=s),this},multiply:function(t){var i=this.m11,s=this.m12,e=this.m21,n=this.m22,r=t.m11,h=t.m12,o=t.m21,u=t.m22;return this.m11=i*r+s*o,this.m12=i*h+s*u,this.m21=e*r+n*o,this.m22=e*h+n*u,this},transformPoint:function(t){var i=t.x,s=t.y,e=this.m11*i+this.m12*s,r=this.m21*i+this.m22*s;return new n(e,r)},transformPointSelf:function(t){var i=t.x,s=t.y;return t.x=this.m11*i+this.m12*s,t.y=this.m21*i+this.m22*s,t},clone:function(){return new r(this.m11,this.m12,this.m21,this.m22)}})}(i),!function(t,i){"use strict";var s=Math.sqrt,e=t.VecArray,n=t.Vector3=t.Class({__static__:{ZERO:function(){return new n([0,0,0])},dot:function(t,i){var s=t.xyz,e=i.xyz;return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]},equals:function(t,i){var s=t.xyz,e=i.xyz;return s[0]==e[0]&&s[1]==e[1]&&s[2]==e[2]},cross:function(t,i){var s=t.xyz,e=i.xyz,r=s[0],h=s[1],o=s[2],u=e[0],a=e[1],l=e[2];return new n([h*l-o*a,o*u-r*l,r*a-h*u])},distance:function(t,i){var e=t.xyz,n=i.xyz,r=e[0]-n[0],h=e[1]-n[1],o=e[2]-n[2];return s(r*r+h*h+o*o)},sum:function(t,i){var s=t.xyz,e=i.xyz;return new n([s[0]+e[0],s[1]+e[1],s[2]+e[2]])}},constructor:function(t,s,n){t&&t.length?this.xyz=new e([t[0],t[1],t[2]]):(t=t===i?0:t,s=s===i?0:s,n=n===i?0:n,this.xyz=new e([t,s,n]))},xyz:null,dispose:function(){return this.xyz=null,this},getXYZ:function(){return new e(this.xyz)},getXYZRef:function(){return this.xyz},setXYZ:function(t){return this.xyz=new e(t),this},setXYZRef:function(t){return this.xyz=t,this},clone:function(){return new n(this.xyz)},equalsSelf:function(t){var i=this.xyz,s=t.xyz;return i[0]==s[0]&&i[1]==s[1]&&i[2]==s[2]},zeroSelf:function(){return this.xyz[0]=0,this.xyz[1]=0,this.xyz[2]=0,this},negate:function(){var t=this.xyz;return new n([-t[0],-t[1],-t[2]])},negateSelf:function(){var t=this.xyz;return t[0]=-t[0],t[1]=-t[1],t[2]=-t[2],this},add:function(t){var i=this.xyz,s=t.xyz;return new n([i[0]+s[0],i[1]+s[1],i[2]+s[2]])},addSelf:function(t){var i=this.xyz,s=t.xyz;return i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],this},subtract:function(t){var i=this.xyz,s=t.xyz;return new n([i[0]-s[0],i[1]-s[1],i[2]-s[2]])},subtractSelf:function(t){var i=this.xyz,s=t.xyz;return i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],this},multiplyScalar:function(t){var i=this.xyz;return new n([i[0]*t,i[1]*t,i[2]*t])},multiplyScalarSelf:function(t){var i=this.xyz;return i[0]*=t,i[1]*=t,i[2]*=t,this},multiply:function(t){var i=this.xyz,s=t.xyz;return new n([i[0]*s[0],i[1]*s[1],i[2]*s[2]])},multiplySelf:function(t){var i=this.xyz,s=t.xyz;return i[0]*=s[0],i[1]*=s[1],i[2]*=s[2],this},divide:function(t){var i=1/t,s=this.xyz;return new n([s[0]*i,s[1]*i,s[2]*i])},divideSelf:function(t){var i=1/t,s=this.xyz;return s[0]*=i,s[1]*=i,s[2]*=i,this},normalize:function(){var t,i=this.xyz,e=i[0],r=i[1],h=i[2],o=e*e+r*r+h*h;return o>0&&(t=1/s(o),e*=t,r*=t,h*=t),new n([e,r,h])},normalizeSelf:function(){var t,i=this.xyz,e=i[0],n=i[1],r=i[2],h=e*e+n*n+r*r;return h>0&&(t=1/s(h),e*=t,n*=t,r*=t),i[0]=e,i[1]=n,i[2]=r,this},getMagnitude:function(){var t=this.xyz,i=t[0],e=t[1],n=t[2];return s(i*i+e*e+n*n)},setMagnitude:function(t){this.normalizeSelf();var i=this.xyz;return i[0]*=t,i[1]*=t,i[2]*=t,this},dotSelf:function(t){var i=this.xyz,s=t.xyz;return i[0]*s[0]+i[1]*s[1]+i[2]*s[2]},crossSelf:function(t){var i=this.xyz,s=t.xyz,e=i[0],n=i[1],r=i[2],h=s[0],o=s[1],u=s[2];return i[0]=n*u-r*o,i[1]=r*h-e*u,i[2]=e*o-n*h,this},distanceSelf:function(t){var i=this.xyz,e=t.xyz,n=i[0]-e[0],r=i[1]-e[1],h=i[2]-e[2];return s(n*n+r*r+h*h)},toString:function(){return"["+this.xyz[0]+" , "+this.xyz[1]+" , "+this.xyz[2]+"]"}})}(i),!function(t,i){"use strict";var s=Math.sin,e=Math.cos,n=t.Matrix4=t.Class({__static__:{multiplyVector:function(t,i){var s=i.xyz,e=s[0],n=s[1],r=s[2];return s[0]=e*t.n11+n*t.n12+r*t.n13+t.n14,s[1]=e*t.n21+n*t.n22+r*t.n23+t.n24,s[2]=e*t.n31+n*t.n32+r*t.n33+t.n34,i},calculateMultiply:function(t,i){var s=t.n11,e=i.n11,n=t.n21,r=i.n21,h=t.n31,o=i.n31,u=t.n12,a=i.n12,l=t.n22,c=i.n22,f=t.n32,d=i.n32,m=t.n13,p=i.n13,x=t.n23,y=i.n23,v=t.n33,g=i.n33,w=t.n14,M=i.n14,z=t.n24,A=i.n24,V=t.n34,b=i.n34;return t.n11=s*e+u*r+m*o,t.n12=s*a+u*c+m*d,t.n13=s*p+u*y+m*g,t.n14=s*M+u*A+m*b+w,t.n21=n*e+l*r+x*o,t.n22=n*a+l*c+x*d,t.n23=n*p+l*y+x*g,t.n24=n*M+l*A+x*b+z,t.n31=h*e+f*r+v*o,t.n32=h*a+f*c+v*d,t.n33=h*p+f*y+v*g,t.n34=h*M+f*A+v*b+V,t}},constructor:function(t,s,e,n,r,h,o,u,a,l,c,f,d,m,p,x){this.n11=t===i?1:t,this.n12=s===i?0:s,this.n13=e===i?0:e,this.n14=n===i?0:n,this.n21=r===i?0:r,this.n22=h===i?1:h,this.n23=o===i?0:o,this.n24=u===i?0:u,this.n31=a===i?0:a,this.n32=l===i?0:l,this.n33=c===i?1:c,this.n34=f===i?0:f,this.n41=d===i?0:d,this.n42=m===i?0:m,this.n43=p===i?0:p,this.n44=x===i?1:x},n11:1,n12:0,n13:0,n14:0,n21:0,n22:1,n23:0,n24:0,n31:0,n32:0,n33:1,n34:0,n41:0,n42:0,n43:0,n44:1,dispose:function(){return this.n11=null,this.n12=null,this.n13=null,this.n14=null,this.n21=null,this.n22=null,this.n23=null,this.n24=null,this.n31=null,this.n32=null,this.n33=null,this.n34=null,this.n41=null,this.n42=null,this.n43=null,this.n44=null,this},reset:function(){return this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1,this},translationMatrix:function(t,i,s){return this.n14=t,this.n24=i,this.n34=s,this},translationMatrixFromVector:function(t){var i=t.xyz;return this.n14=i[0],this.n24=i[1],this.n34=i[2],this},scaleMatrix:function(t,i,s){return this.n11=t,this.n22=i,this.n33=s,this},scaleMatrixFromVector:function(t){var i=t.xyz;return this.n11=i[0],this.n22=i[0],this.n33=i[0],this},rotationMatrix:function(t,i,n,r){var h=e(r),o=s(r),u=1-h,a=t*i*u,l=i*n*u,c=t*n*u,f=o*n,d=o*i,m=o*t;return this.n11=h+t*t*u,this.n12=-f+a,this.n13=d+c,this.n14=0,this.n21=f+a,this.n22=h+i*i*u,this.n23=-m+l,this.n24=0,this.n31=-d+c,this.n32=m+l,this.n33=h+n*n*u,this.n34=0,this},rotationMatrixFromVector:function(t,i){var n=t.xyz,r=n[0],h=n[1],o=n[2],u=e(i),a=s(i),l=1-u,c=r*h*l,f=h*o*l,d=r*o*l,m=a*o,p=a*h,x=a*r;return this.n11=u+r*r*l,this.n12=-m+c,this.n13=p+d,this.n14=0,this.n21=m+c,this.n22=u+h*h*l,this.n23=-x+f,this.n24=0,this.n31=-p+d,this.n32=x+f,this.n33=u+o*o*l,this.n34=0,this},multiply:function(t){return n.calculateMultiply(this,t),this},multiplyVector:function(t){var i=t.xyz,s=i[0],e=i[1],n=i[2];return i[0]=s*this.n11+e*this.n12+n*this.n13+this.n14,i[1]=s*this.n21+e*this.n22+n*this.n23+this.n24,i[2]=s*this.n31+e*this.n32+n*this.n33+this.n34,t}})}(i),!function(t,i){"use strict";var s=t.ModConstant,e=s.X,n=s.Y,r=s.Z,h=t.Vector3,o=t.VecArray,u=t.VertexProxy=t.Class({constructor:function(t){this.xyz=new o([0,0,0]),this.original=new o([0,0,0]),this.ratio=new o([0,0,0]),i!==t&&null!==t&&!1!==t&&this.setVertex(t)},name:"VertexProxy",vertex:null,xyz:null,original:null,ratio:null,dispose:function(){return this.vertex=null,this.xyz=null,this.original=null,this.ratio=null,this},serialize:function(){return{vertex:this.name,xyz:this.getXYZ(),original:this.original,ratio:this.ratio}},unserialize:function(t){return t&&this.name===t.vertex&&(this.xyz=this.setXYZ(t.xyz),this.original=t.original,this.ratio=t.ratio),this},setVertex:function(t){return this.vertex=t,this},getRatioVector:function(){return new h(this.ratio)},getRatio:function(t){switch(t){case e:return this.ratio[0];case n:return this.ratio[1];case r:return this.ratio[2]}return-1},getOriginalValue:function(t){switch(t){case e:return this.original[0];case n:return this.original[1];case r:return this.original[2]}return 0},setRatios:function(t,s,e){return t=t===i?0:t,s=s===i?0:s,e=e===i?0:e,this.ratio=new o([t,s,e]),this},setOriginalPosition:function(t,s,e){return t=t===i?0:t,s=s===i?0:s,e=e===i?0:e,this.original=new o([t,s,e]),this},getXYZ:function(){return new o(this.xyz)},getXYZRef:function(){return this.xyz},getX:function(){return this.xyz[0]},getY:function(){return this.xyz[1]},getZ:function(){return this.xyz[2]},setXYZ:function(t){return this.xyz=new o(t),this},setXYZRef:function(t){return this.xyz=t,this},setX:function(t){return this.xyz[0]=t,this},setY:function(t){return this.xyz[1]=t,this},setZ:function(t){return this.xyz[2]=t,this},getValue:function(t){switch(t){case e:return this.getX();case n:return this.getY();case r:return this.getZ()}return 0},setValue:function(t,i){switch(t){case e:this.setX(i);break;case n:this.setY(i);break;case r:this.setZ(i)}return this},reset:function(){return this.setXYZ(this.original),this},collapse:function(){return this.original=this.getXYZ(),this},getVector:function(){return new h(this.getXYZ())},setVector:function(t){this.setXYZ(t.xyz)}});u.unserialize-function(i){return i&&i.vertex&&t[i.vertex]?(new t[i.vertex]).unserialize(i):new u}}(i),!function(t){"use strict";var i=t.FaceProxy=t.Class(Object,{constructor:function(){this.vertices=[]},name:"FaceProxy",vertices:null,dispose:function(){return this.vertices=null,this},serialize:function(){return{face:this.name,vertices:null}},unserialize:function(t){return t&&this.name===t.face&&(this.vertices=t.vertices||null),this},addVertex:function(t){this.vertices.push(t)},getVertices:function(){return this.vertices}});i.unserialize-function(s){return s&&s.face&&t[s.face]?(new t[s.face]).unserialize(s):new i}}(i),!function(t,i){"use strict";var s=t.ModConstant,e=s.X,n=s.Y,r=s.Z,h=Math.min,o=Math.max,u=t.MeshProxy=t.Class({constructor:function(t){this.maxX=null,this.maxY=null,this.maxZ=null,this.minX=null,this.minY=null,this.minZ=null,this.maxAxis=null,this.midAxis=null,this.minAxis=null,this.width=null,this.height=null,this.depth=null,this.vertices=[],this.faces=[],this.mesh=null,i!==t&&this.setMesh(t)},name:"MeshProxy",maxX:null,maxY:null,maxZ:null,minX:null,minY:null,minZ:null,maxAxis:null,midAxis:null,minAxis:null,widht:null,height:null,depth:null,vertices:null,faces:null,mesh:null,dispose:function(){return this.maxX=null,this.maxY=null,this.maxZ=null,this.minX=null,this.minY=null,this.minZ=null,this.maxAxis=null,this.midAxis=null,this.minAxis=null,this.widht=null,this.height=null,this.depth=null,this.disposeFaces(),this.disposeVertices(),this.mesh=null,this},disposeVertices:function(){var t,i;if(this.vertices)for(i=this.vertices.length,t=0;i>t;t++)this.vertices[t].dispose();return this.vertices=null,this},disposeFaces:function(){var t,i;if(this.faces)for(i=this.faces.length,t=0;i>t;t++)this.faces[t].dispose();return this.faces=null,this},serialize:function(){var t=function(t){return t?t.serialize():t};return{mesh:this.name,vertices:this.vertices?this.vertices.map(t):null,faces:null}},unserialize:function(i){if(i&&this.name===i.mesh){var s=function(i){return i&&i.vertex?t.VertexProxy.unserialize(i):i};this.disposeFaces(),this.disposeVertices(),this.vertices=(i.vertices||[]).map(s),this.faces=null}return this},setMesh:function(t){return this.mesh=t,this.vertices=[],this},getVertices:function(){return this.vertices},getFaces:function(){return this.faces},analyzeGeometry:function(){var t,i,s,u,a,l,c,f,d,m,p,x,y,v=this.vertices,g=v.length,w=g;for(g&&(t=v[0],i=t.getXYZ(),s=i[0],u=i[1],a=i[2],l=c=s,f=d=u,m=p=a);--w>=0;)t=v[w],i=t.getXYZ(),s=i[0],u=i[1],a=i[2],t.setOriginalPosition(s,u,a),l=h(l,s),f=h(f,u),m=h(m,a),c=o(c,s),d=o(d,u),p=o(p,a);x=c-l,y=d-f,depth=p-m,this.width=x,this.height=y,this.depth=depth,this.minX=l,this.maxX=c,this.minY=f,this.maxY=d,this.minZ=m,this.maxZ=p;var M=o(x,y,depth),z=h(x,y,depth);for(M==x&&z==y?(this.minAxis=n,this.midAxis=r,this.maxAxis=e):M==x&&z==depth?(this.minAxis=r,this.midAxis=n,this.maxAxis=e):M==y&&z==x?(this.minAxis=e,this.midAxis=r,this.maxAxis=n):M==y&&z==depth?(this.minAxis=r,this.midAxis=e,this.maxAxis=n):M==depth&&z==x?(this.minAxis=e,this.midAxis=n,this.maxAxis=r):M==depth&&z==y&&(this.minAxis=n,this.midAxis=e,this.maxAxis=r),w=g;--w>=0;)t=v[w],i=t.getXYZ(),t.setRatios((i[0]-l)/x,(i[1]-f)/y,(i[2]-m)/depth);return this},resetGeometry:function(){for(var t=this.vertices,i=t.length;--i>=0;)t[i].reset();return this.update(),this},collapseGeometry:function(){for(var t=this.vertices,i=t.length;--i>=0;)t[i].collapse();return this.update(),this.analyzeGeometry(),this},getMin:function(t){switch(t){case e:return this.minX;case n:return this.minY;case r:return this.minZ}return-1},getMax:function(t){switch(t){case e:return this.maxX;case n:return this.maxY;case r:return this.maxZ}return-1},getSize:function(t){switch(t){case e:return this.width;case n:return this.height;case r:return this.depth}return-1},update:function(){return this},postApply:function(){return this},updateMeshPosition:function(){return this}});u.unserialize-function(i){return i&&i.mesh&&t[i.mesh]?(new t[i.mesh]).unserialize(i):new u}}(i),!function(t){"use strict";var i=0,s=t.ModConstant.NONE;t.Modifier=t.Class(t.WorkerInterface,{constructor:function(t){this.id=++i,this.name="Modifier",this.mod=t||null,this.axes=s,this.constraint=s,this.enabled=!0},id:null,name:"Modifier",mod:null,axes:null,constraint:null,enabled:!0,dispose:function(t){return this.disposeWorker(),!0===t&&this.mod&&this.mod.dispose(),this.mod=null,this.name=null,this.axes=null,this.constraint=null,this},enable:function(t){return arguments.length?(this.enabled=!!t,this):this.enabled},constraintAxes:function(t){return this.axes=t||s,this},setConstraint:function(t){return this.constraint=t||s,this},setModifiable:function(t){return this.mod=t,this},getVertices:function(){return this.mod?this.mod.getVertices():null},_apply:function(){return this},apply:function(t){var i=this;return i._worker?i.bind("apply",function(s){i.unbind("apply"),s&&s.modifiable&&i.mod.unserialize(s.modifiable),t&&t.call(i)}).send("apply",{modifiable:i.mod.serialize()}):(i._apply(),t&&t.call(i)),i},toString:function(){return"[Modifier "+this.name+"]"}})}(i),!function(t){"use strict";t.Library3d=t.Class({constructor:function(){this.id="",this.meshClass=null,this.vertexClass=null},id:"",meshClass:null,vertexClass:null}),t.PluginFactory=t.StaticClass({getMeshProxy:function(t){var i=t.meshClass;return i?new i:null}})}(i),!function(t){"use strict";var i=t.PluginFactory.getMeshProxy,s=t.ModifierStack=t.Class(t.WorkerInterface,{constructor:function(t,s){this.baseMesh=null,this.stack=[],this.lib3d=t,this.baseMesh=i(t),this.baseMesh.setMesh(s),this.baseMesh.analyzeGeometry()},name:"ModifierStack",lib3d:null,baseMesh:null,stack:null,dispose:function(t){if(this.lib3d=null,t&&this.stack)for(;this.stack.length;)this.stack.pop().dispose();return this.stack=null,this.baseMesh&&this.baseMesh.dispose(),this.baseMesh=null,this},add:function(t){return t&&(t.setModifiable(this.baseMesh),this.stack.push(t)),this},apply:function(){if(this.baseMesh&&this.stack&&this.stack.length){var t=this.stack,i=t.length,s=this.baseMesh,e=0;for(s.resetGeometry();i>e;)t[e].enabled&&t[e].apply(),e++;s.update()}return this},collapse:function(){return this.baseMesh&&this.stack&&this.stack.length&&(this.apply(),this.baseMesh.collapseGeometry(),this.stack.length=0),this},clear:function(){return this.stack&&(this.stack.length=0),this},getMeshInfo:function(){return this.baseMesh}});s.prototype.addModifier=s.prototype.add}(i),function(t){function i(t,i,s){this.x=t,this.y=i,this.z=s}function s(t){return t*t*t*(t*(6*t-15)+10)}function e(t,i,s){return(1-s)*t+s*i}var n=t.noise={};i.prototype.dot2=function(t,i){return this.x*t+this.y*i},i.prototype.dot3=function(t,i,s){return this.x*t+this.y*i+this.z*s};var r=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],h=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=new Array(512),u=new Array(512);n.seed=function(t){t>0&&1>t&&(t*=65536),t=Math.floor(t),256>t&&(t|=t<<8);for(var i=0;256>i;i++){var s;s=1&i?h[i]^255&t:h[i]^255&t>>8,o[i]=o[i+256]=s,u[i]=u[i+256]=r[s%12]}},n.seed(0);var a=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,c=1/3,f=1/6;n.simplex2=function(t,i){var s,e,n,r,h,c=(t+i)*a,f=Math.floor(t+c),d=Math.floor(i+c),m=(f+d)*l,p=t-f+m,x=i-d+m;p>x?(r=1,h=0):(r=0,h=1);var y=p-r+l,v=x-h+l,g=p-1+2*l,w=x-1+2*l;f&=255,d&=255;var M=u[f+o[d]],z=u[f+r+o[d+h]],A=u[f+1+o[d+1]],V=.5-p*p-x*x;0>V?s=0:(V*=V,s=V*V*M.dot2(p,x));var b=.5-y*y-v*v;0>b?e=0:(b*=b,e=b*b*z.dot2(y,v));var k=.5-g*g-w*w;return 0>k?n=0:(k*=k,n=k*k*A.dot2(g,w)),70*(s+e+n)},n.simplex3=function(t,i,s){var e,n,r,h,a,l,d,m,p,x,y=(t+i+s)*c,v=Math.floor(t+y),g=Math.floor(i+y),w=Math.floor(s+y),M=(v+g+w)*f,z=t-v+M,A=i-g+M,V=s-w+M;z>=A?A>=V?(a=1,l=0,d=0,m=1,p=1,x=0):z>=V?(a=1,l=0,d=0,m=1,p=0,x=1):(a=0,l=0,d=1,m=1,p=0,x=1):V>A?(a=0,l=0,d=1,m=0,p=1,x=1):V>z?(a=0,l=1,d=0,m=0,p=1,x=1):(a=0,l=1,d=0,m=1,p=1,x=0);var b=z-a+f,k=A-l+f,C=V-d+f,X=z-m+2*f,Y=A-p+2*f,Z=V-x+2*f,P=z-1+3*f,S=A-1+3*f,_=V-1+3*f;v&=255,g&=255,w&=255;var I=u[v+o[g+o[w]]],R=u[v+a+o[g+l+o[w+d]]],F=u[v+m+o[g+p+o[w+x]]],$=u[v+1+o[g+1+o[w+1]]],N=.5-z*z-A*A-V*V;0>N?e=0:(N*=N,e=N*N*I.dot3(z,A,V));var T=.5-b*b-k*k-C*C;0>T?n=0:(T*=T,n=T*T*R.dot3(b,k,C));var L=.5-X*X-Y*Y-Z*Z;0>L?r=0:(L*=L,r=L*L*F.dot3(X,Y,Z));var O=.5-P*P-S*S-_*_;return 0>O?h=0:(O*=O,h=O*O*$.dot3(P,S,_)),32*(e+n+r+h)},n.perlin2=function(t,i){var n=Math.floor(t),r=Math.floor(i);t-=n,i-=r,n=255&n,r=255&r;var h=u[n+o[r]].dot2(t,i),a=u[n+o[r+1]].dot2(t,i-1),l=u[n+1+o[r]].dot2(t-1,i),c=u[n+1+o[r+1]].dot2(t-1,i-1),f=s(t);return e(e(h,l,f),e(a,c,f),s(i))},n.perlin3=function(t,i,n){var r=Math.floor(t),h=Math.floor(i),a=Math.floor(n);t-=r,i-=h,n-=a,r=255&r,h=255&h,a=255&a;var l=u[r+o[h+o[a]]].dot3(t,i,n),c=u[r+o[h+o[a+1]]].dot3(t,i,n-1),f=u[r+o[h+1+o[a]]].dot3(t,i-1,n),d=u[r+o[h+1+o[a+1]]].dot3(t,i-1,n-1),m=u[r+1+o[h+o[a]]].dot3(t-1,i,n),p=u[r+1+o[h+o[a+1]]].dot3(t-1,i,n-1),x=u[r+1+o[h+1+o[a]]].dot3(t-1,i-1,n),y=u[r+1+o[h+1+o[a+1]]].dot3(t-1,i-1,n-1),v=s(t),g=s(i),w=s(n);return e(e(e(l,m,v),e(c,p,v),w),e(e(f,x,v),e(d,y,v),w),g)}}(this),function(t){"use strict";var i=t.Vector3;t.Pivot=t.Class(t.Modifier,{constructor:function(t,s,e){this.$super("constructor"),this.name="Pivot",this.pivot=new i([t,s,e])},pivot:null,dispose:function(){return this.pivot.dispose(),this.pivot=null,this.$super("dispose"),this},setMeshCenter:function(){var t=this.mod;return this.pivot=new i(-(t.minX+.5*t.width),-(t.minY+.5*t.height),-(t.minZ+.5*t.depth)),this},apply:function(){for(var t,i=this.mod.vertices,s=i.length,e=this.pivot;--s>=0;)t=i[s],t.setVector(t.getVector().addSelf(e));return this.mod.updateMeshPosition(e.negate()),this}})}(i),function(t,i){"use strict";var s=t.ModConstant.NONE,e=t.ModConstant.LEFT,n=t.ModConstant.RIGHT,r=t.Matrix,h=Math.atan,o=(Math.atan2,Math.sin),u=Math.cos,a=t.Constants.PI,l=t.Constants.halfPI,c=t.Constants.doublePI,f=t.Point;t.Bend=t.Class(t.Modifier,{constructor:function(t,e,n){this.$super("constructor"),this.name="Bend",this.constraint=s,this.max=0,this.min=0,this.mid=0,this.width=0,this.height=0,this.origin=0,this.m1=null,this.m2=null,this.diagAngle=0,this.switchAxes=!1,this.force=t!==i?t:0,this.offset=e!==i?e:0,n!==i?this.setAngle(n):this.setAngle(0)},force:0,offset:0,angle:0,diagAngle:0,max:0,min:0,mid:0,width:0,height:0,origin:0,m1:null,m2:null,switchAxes:!1,dispose:function(){return this.force=null,this.offset=null,this.angle=null,this.diagAngle=null,this.max=null,this.min=null,this.mid=null,this.width=null,this.height=null,this.origin=null,this.m1&&this.m1.dispose(),this.m2&&this.m2.dispose(),this.m1=null,this.m2=null,this.switchAxes=null,this.$super("dispose"),this},setAngle:function(t){return this.angle=t,this.m1=(new r).rotate(t),this.m2=(new r).rotate(-t),this},setModifiable:function(t){return this.$super("setModifiable",t),this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis,this.min=this.mod.minAxis,this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis,this.width=this.mod.getSize(this.max),this.height=this.mod.getSize(this.mid),this.origin=this.mod.getMin(this.max),this.diagAngle=h(this.width/this.height),this},apply:function(){if(!this.force)return this;for(var t,i,s,r,h,d,m,p,x,y,v=this.mod.vertices,g=v.length,w=this.constraint,M=this.width,z=this.offset,A=this.origin,V=this.force,b=this.max,k=this.min,C=this.mid,X=this.m1,Y=this.m2,Z=A+M*z,P=M/a/V,S=c*(M/(P*c)),_=1/M;--g>=0;)t=v[g],i=t.getValue(b),s=t.getValue(C),r=t.getValue(k),h=X.transformPointSelf(new f(i,s)),i=h.x,s=h.y,d=(i-A)*_,e===w&&z>=d||n===w&&d>=z||(m=l-S*z+S*d,p=o(m)*(P+r),x=u(m)*(P+r),r=p-P,i=Z-x),y=Y.transformPointSelf(new f(i,s)),i=y.x,s=y.y,t.setValue(b,i),t.setValue(C,s),t.setValue(k,r);return this}})}(i),function(t){"use strict";var i=t.Vector3,s=Math.max,e=Math.exp;t.Bloat=t.Class(t.Modifier,{constructor:function(){this.$super("constructor"),this.name="Bloat",this.radius=0,this.a=.01,this.center=i.ZERO()},center:null,radius:0,a:.01,dispose:function(){return this.center.dispose(),this.center=null,this.radius=null,this.a=null,this.$super("dispose"),this},setRadius:function(t){return this.radius=s(0,t),this},setA:function(t){return this.a=s(0,t),this},apply:function(){for(var t,i,s,n=this.mod.vertices,r=n.length,h=this.center,o=this.radius,u=this.a;--r>=0;)t=n[r],s=t.getVector().subtractSelf(h),i=s.getMagnitude(),s.setMagnitude(i+o*e(-i*u)),t.setVector(s.addSelf(h));return this}})}(i),function(t,i){"use strict";var s=t.Vector3,e=t.Matrix4;t.Twist=t.Class(t.Modifier,{constructor:function(t){this.$super("constructor"),this.name="Twist",this.vector=new s([0,1,0]).normalizeSelf(),this.angle=t!==i?t:0,this.center=s.ZERO(),this.mat1=new e,this.mat2=new e},vector:null,angle:0,center:null,mat1:null,mat2:null,dispose:function(){return this.vector.dispose(),this.vector=null,this.angle=null,this.center.dispose(),this.center=null,this.mat1.dispose(),this.mat2.dispose(),this.mat1=null,this.mat2=null,this.$super("dispose"),this},apply:function(){for(var t,i,e,n=this.mod,r=n.vertices,h=r.length,o=this.vector,u=this.angle,a=this.center,l=new s([.5*n.maxX,.5*n.maxY,.5*n.maxZ]),c=1/l.getMagnitude(),f=c*u,d=-s.dot(o,a);--h>=0;)t=r[h],e=t.getVector(),i=s.dot(e,o)+d,t.setVector(this.twistPoint(e,o,i*f));return this},twistPoint:function(t,i,e){var n=this.mat1.reset().translationMatrixFromVector(t),r=this.mat2.reset().rotationMatrixFromVector(i,e);return r.multiply(n),new s([r.n14,r.n24,r.n34])}})}(i),function(t,i){"use strict";var s=Math.abs,e=Math.pow,n=(t.XMath.sign,t.ModConstant),r=n.NONE,h=n.LEFT,o=n.RIGHT,u=n.X,a=n.Y,l=n.Z;t.Skew=t.Class(t.Modifier,{constructor:function(t){this.$super("constructor"),this.name="Skew",this.force=t!==i?t:0,this.offset=.5,this.constraint=r,this.power=1,this.falloff=1,this.inverseFalloff=!1,this.oneSide=!1,this.swapAxes=!1,this.skewAxis=0},force:0,skewAxis:0,offset:.5,power:1,falloff:1,inverseFalloff:!1,oneSide:!1,swapAxes:!1,dispose:function(){return this.force=null,this.skewAxis=null,this.offset=null,this.power=null,this.falloff=null,this.inverseFalloff=null,this.oneSide=null,this.swapAxes=null,this.$super("dispose"),this},setModifiable:function(t){return this.$super("setModifiable",t),this.skewAxis=this.skewAxis||this.mod.maxAxis,this},apply:function(){for(var t,i,n,r,u,a,l,c,f=this.mod.vertices,d=f.length,m=this.constraint,p=this.skewAxis,x=this.offset,y=this.oneSide,v=this.inverseFalloff,g=this.falloff,w=1-g,M=this.power,z=this.force,A=this.getDisplaceAxis();--d>=0;)t=f[d],l=t.getRatio(p),h===m&&x>=l||o===m&&l>x||(i=l-x,y&&(i=s(i)),n=t.getRatio(A),v&&(n=1-n),r=g+n*w,c=0>i?-1:1,u=e(s(i),M)*c,a=t.getValue(A)+z*u*r,t.setValue(A,a));return this},getDisplaceAxis:function(){var t=this.skewAxis,i=this.swapAxes;switch(t){case u:return i?l:a;case a:return i?l:u;case l:return i?a:u}}})}(i),function(t,i){"use strict";var s=t.Vector3,e=t.Matrix4,n=Math.pow;t.Taper=t.Class(t.Modifier,{constructor:function(t,e){this.$super("constructor"),this.name="Taper",this.vector=new s([1,0,1]),this.vector2=new s([0,1,0]),this.force=t!==i?t:0,this.power=e!==i?e:1},force:0,power:1,vector:null,vector2:null,dispose:function(){return this.vector.dispose(),this.vector2.dispose(),this.vector=null,this.vector2=null,this.force=null,this.power=null,this.$super("dispose"),this},apply:function(){var t,i,s,r,h,o,u=this.mod.vertices,a=u.length,l=this.vector,c=this.vector2,f=this.force,d=this.power;for(r=new e;--a>=0;)t=u[a],i=t.getRatioVector().multiply(c),s=1!==d?f*n(i.getMagnitude(),d):f*i.getMagnitude(),o=l.xyz,r.reset().scaleMatrix(1+s*o[0],1+s*o[1],1+s*o[2]),h=t.getVector(),t.setVector(r.multiplyVector(h));return this}})}(i),function(t){"use strict";var i=t.Constants.invPI,s=t.Constants.doublePI,e=t.Vector3,n=t.Matrix4;t.Wheel=t.Class(t.Modifier,{constructor:function(){this.$super("constructor"),this.name="Wheel",this.speed=0,this.turn=0,this.roll=0,this.radius=0,this.steerVector=new e([0,1,0]),this.rollVector=new e([0,0,1])},speed:0,turn:0,roll:0,radius:0,steerVector:null,rollVector:null,dispose:function(){return this.speed=null,this.turn=null,this.roll=null,this.radius=null,this.steerVector.dispose(),this.rollVector.dispose(),this.steerVector=null,this.rollVector=null,this.$super("dispose"),this
},setModifiable:function(t){return this.$super("setModifiable",t),this.radius=.5*this.mod.width,this},apply:function(){var t,i,s=this.mod.vertices,e=s.length,r=this.steerVector,h=this.turn,o=this.rollVector,u=this.roll,a=null,l=null,c=null;for(this.roll+=this.speed,h?(l=(new n).rotationMatrixFromVector(r,h),c=l.multiplyVector(o.clone()),a=(new n).rotationMatrixFromVector(c,u)):a=(new n).rotationMatrixFrom(o,u);--e>=0;)t=s[e],i=t.getVector(),l&&l.multiplyVector(i),t.setVector(a.multiplyVector(i));return this},getStep:function(){return this.radius*this.speed*i},getPerimeter:function(){return this.radius*s}})}(i),function(t,i){"use strict";var s=t.Vector3,e=t.Range,n=t.Matrix4;t.Break=t.Class(t.Modifier,{constructor:function(t,n){this.$super("constructor"),this.name="Break",this.bv=new s([0,1,0]),this.range=new e(0,1),this.offset=t!==i?t:0,this.angle=n!==i?n:0},bv:null,range:null,offset:0,angle:0,dispose:function(){return this.bv.dispose(),this.bv=null,this.range.dispose(),this.range=null,this.offset=null,this.angle=null,this.$super("dispose"),this},apply:function(){var t,i,e,r,h,o=this.mod,u=o.vertices,a=u.length,l=this.offset,c=this.range,f=this.angle,d=this.bv,m=d.xyz;for(t=new s([0,0,-(o.minZ+o.depth*l)]),i=t.negate(),h=(new n).rotationMatrix(m[0],m[1],m[2],f);--a>=0;)e=u[a],r=e.getVector().addSelf(t),r.xyz[2]>=0&&c.isIn(e.ratio[1])&&h.multiplyVector(r),e.setVector(r.addSelf(i));return this}})}(i),function(t,i){"use strict";var s=t.ModConstant.NONE,e=t.ModConstant.X,n=t.ModConstant.Y,r=t.ModConstant.Z,h=(t.VecArray,Math.random);t.Noise=t.Class(t.Modifier,{constructor:function(t){this.$super("constructor"),this.name="Noise",this.axes=s,this.start=0,this.end=0,this.force=t!==i?t:0},force:0,start:0,end:1,dispose:function(){return this.force=null,this.start=null,this.end=null,this.$super("dispose"),this},setFalloff:function(t,s){return this.start=t!==i?t:0,this.end=s!==i?s:1,this},apply:function(){var t,i,s,o,u,a=this.mod,l=this.axes,c=this.start,f=this.end,d=a.vertices,m=d.length,p=this.force,x=.5*p,y=a.maxAxis;if(!l||!p)return this;for(;--m>=0;)t=d[m],i=h()*p-x,s=t.getRatio(y),f>c?c>s?s=0:s>f&&(s=1):c>f?(s=1-s,s>c?s=0:f>s&&(s=1)):s=1,o=i*s,u=t.getXYZ(),t.setXYZ([u[0]+(l&e?0:o),u[1]+(l&n?0:o),u[2]+(l&r?0:o)]);return this}})}(i),function(t){"use strict";var i=t.ModConstant,s=(i.NONE,i.X),e=i.Y,n=i.Z;t.DisplaceMap=t.Class(t.Modifier,{constructor:function(t,i,r,h){this.$super("constructor"),this.name="DisplaceMap",arguments.length>=3?(this.setBitmap(t,i,r),this.force=h||1):this.force=t||1,this.offset=127,this.axes=s|e|n},width:null,height:null,bitmapData:null,force:1,offset:127,dispose:function(){return this.bitmapData=null,this.width=null,this.height=null,this.force=null,this.offset=null,this.$super("dispose"),this},setBitmap:function(t,i,s){return this.bitmapData=t||null,this.width=i||0,this.height=s||0,this},apply:function(){var t,i,r,h,o,u=this.mod.vertices,a=u.length,l=this.axes,c=this.width,f=this.height,d=this.bitmapData,m=this.force,p=this.offset;if(!l||!d)return this;for(;--a>=0;)t=u[a],o=t.getXYZ(),r=~~((c-1)*t.ratio[0]),h=~~((f-1)*t.ratio[2]),i=h*c+r<<2,l&s&&(o[0]+=((255&d[i]>>16)-p)*m),l&e&&(o[1]+=((255&d[i+1]>>8)-p)*m),l&n&&(o[2]+=((255&d[i+2])-p)*m),t.setXYZ(o);return this}})}(i),function(t,i){"use strict";var s=(t.Vector3,Math.round),e=t.VecArray,n=t.ModConstant,r=(n.NONE,n.X),h=n.Y,o=n.Z,u=t.PerlinNoise=t.Class(Object,{constructor:function(t,e){this.width=i!==t?s(t):10,this.height=i!==e?s(e):10},width:10,height:10,data:null,dispose:function(){return this.data=null,this.width=this.height=null,this},uvIndex:function(t,i){var s=this.width,e=this.height,n=~~((s-1)*t),r=~~((e-1)*i);return n+r*s},generate:function(){var t,i,s,n=this.width,r=this.height,h=n*r,o=new e(h);for(t=0,i=0,s=0;h>s;s++,t++)t>=n&&(t=0,i++),o[s]=noise.simplex2(t/n,i/r);return this.data=o,this},move:function(t,i){var s,n,r,h,o,u,a=this.width,l=this.height,c=a*l,f=this.data,d=new e(c);for(0>t&&(t+=a),0>i&&(i+=l),t=~~t,i=~~i,s=0,n=0,o=0;c>o;o++,s++)s>=a&&(s=0,n++),r=(s+t)%a,h=(n+i)%l,u=r+h*a,d[o]=f[u];return this.data=d,this}});t.Perlin=t.Class(t.Modifier,{constructor:function(t,s,e){this.$super("constructor"),this.name="Perlin",this.source=i===s?new u(25,25).generate():s,this.force=t||1,this.autoRun=i!==e?!!e:!0,this.axes=r|h|o},speedX:1,speedY:1,source:null,force:1,offset:0,autoRun:!0,dispose:function(){return this.source=null,this.speedX=null,this.speedY=null,this.force=null,this.offset=null,this.autoRun=null,this.$super("dispose"),this},setSpeed:function(t,i){return this.speedX=t,this.speedY=i,this},apply:function(){var t,i,s,e=this.mod.vertices,n=e.length,u=this.axes,a=this.force,l=this.offset,c=this.source;if(!u||!c)return this;for(this.autoRun&&c.move(this.speedX,this.speedY),t=c.data;--n>=0;)i=e[n],xyz=i.getXYZ(),s=c.uvIndex(i.ratio[0],i.ratio[2]),u&r&&(xyz[0]+=(t[s]-l)*a),u&h&&(xyz[1]+=(t[s]-l)*a),u&o&&(xyz[2]+=(t[s]-l)*a),i.setXYZ(xyz);return this}})}(i),!function(t){"use strict";var i=t.ModConstant,s=i.X,e=i.Y,n=i.Z,r=t.Vector3,h=t.VecArray,o=t.VertexThree=t.Class(t.VertexProxy,{constructor:function(t,i){this.mesh=t,this.$super("constructor",i),this.name="VertexThree"},mesh:null,dispose:function(){return this.mesh=null,this.$super("dispose"),this},setVertex:function(t){return this.vertex=t,this.original=new h([t.x,t.y,t.z]),this.xyz=new h(this.original),this},getXYZ:function(){var t=this.vertex;return new h([t.x,t.y,t.z])},getX:function(){return this.vertex.x},getY:function(){return this.vertex.y},getZ:function(){return this.vertex.z},setXYZ:function(t){var i=this.vertex;return this.mesh.geometry,i.x=t[0],i.y=t[1],i.z=t[2],this},setX:function(t){var i=this.vertex;return i.x=t,this},setY:function(t){var i=this.vertex;return i.y=t,this},setZ:function(t){var i=this.vertex;return i.z=t,this},reset:function(){var t=this.vertex,i=(this.mesh.geometry,this.original);return t.x=i[0],t.y=i[1],t.z=i[2],this},collapse:function(){var t=this.vertex;return this.original=new h([t.x,t.y,t.z]),this},getValue:function(t){var i=this.vertex;switch(t){case s:return i.x;case e:return i.y;case n:return i.z}return 0},setValue:function(t,i){var r=this.vertex,h=!1;switch(t){case s:r.x=i,h=!0;break;case e:r.y=i,h=!0;break;case n:r.z=i,h=!0}return this},setVector:function(t){var i=this.vertex,s=t.xyz;return this.mesh.geometry,i.x=s[0],i.y=s[1],i.z=s[2],this},getVector:function(){var t=this.vertex;return new r([t.x,t.y,t.z])}});o.prototype.getXYZRef=o.prototype.getXYZ,o.prototype.setXYZRef=o.prototype.setXYZ}(i),!function(t){"use strict";var i=t.VertexThree;t.FaceProxy,t.MeshThree=t.Class(t.MeshProxy,{constructor:function(t){this.$super("constructor",t),this.name="MeshThree"},setMesh:function(t){this.$super("setMesh",t);var s,e=0,t=this.mesh,n=this.vertices,r=t.geometry.vertices,h=r.length,o=t.geometry.faces;for(o.length,e=0;h>e;)s=new i(t,r[e]),n.push(s),e++;return this.faces=null,this},update:function(){var t=this.mesh.geometry;return t.verticesNeedUpdate=!0,t.normalsNeedUpdate=!0,t.buffersNeedUpdate=!0,t.dynamic=!0,this},updateMeshPosition:function(t){var i=this.mesh.position,s=t.xyz;return i.x+=s[0],i.y+=s[1],i.z+=s[2],this}})}(i),!function(t){"use strict";var i=t.Class(t.Library3d,{constructor:function(){this.id="Three.js",this.meshClass=t.MeshThree,this.vertexClass=t.VertexThree}});t.LibraryThree=new i}(i),i});