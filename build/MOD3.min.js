/**
*
* http://github.com/foo123/MOD3
*
* MOD3 3D Modifier Library (port of actionscript AS3Mod to javascript)
* supports: THREE.js, J3D, Copperlicht, CubicVR, Pre3D
*
* @author Nikos M. http://nikos-web-development.netai.net/
*
**/var MOD3=MOD3||{};!function(t){t.Constants={PI:Math.PI,invPI:1/Math.PI,halfPI:.5*Math.PI,doublePI:2*Math.PI,toRad:1/180*Math.PI,toDeg:1/180*Math.PI},t.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4}}(MOD3),function(t){var e=t.Constants;t.XMath={},t.XMath.normalize=function(e,i,o){var n,r=i-e;return n=0==r?1:t.XMath.trim(0,1,(o-e)/i)},t.XMath.toRange=function(t,e,i){var o,n=e-t;return o=0==n?0:t+(e-t)*i},t.XMath.inRange=function(t,e,i,o){return"undefined"==typeof o&&(o=!1),o?i>=t&&e>=i:i>t&&e>i},t.XMath.sign=function(t,e){return"undefined"==typeof e&&(e=0),0==t?e:t>0?1:-1},t.XMath.trim=function(t,e,i){return Math.min(e,Math.max(t,i))},t.XMath.wrap=function(t,e,i){return t>i?i+(e-t):i>=e?i-(e-t):i},t.XMath.degToRad=function(t){return t*e.toRad},t.XMath.radToDeg=function(t){return t*e.toDeg},t.XMath.presicion=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},t.XMath.uceil=function(t){return 0>t?Math.floor(t):Math.ceil(t)}}(MOD3),function(t){t.Range=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Range.prototype.getSize=function(){return this.end-this.start},t.Range.prototype.move=function(t){this.start+=t,this.end+=t},t.Range.prototype.isIn=function(t){return t>=this.start&&t<=this.end},t.Range.prototype.normalize=function(e){return t.XMath.normalize(this.start,this.end,e)},t.Range.prototype.toRange=function(e){return t.XMath.toRange(this.start,this.end,e)},t.Range.prototype.trim=function(e){return t.XMath.trim(this.start,this.end,e)},t.Range.prototype.interpolate=function(t,e){return this.toRange(e.normalize(t))},t.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"}}(MOD3),function(t){t.Phase=function(t){this.value=0,"undefined"!=typeof t&&(this.value=t)},t.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)},t.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())},t.Phase.prototype.getNormValue=function(){return.5*(this.getPhasedValue()+1)}}(MOD3),function(t){t.Point=function(t,e){this.x=0,this.y=0,"undefined"!=typeof t&&(this.x=t),"undefined"!=typeof e&&(this.y=e)},t.Point.prototype.clone=function(){return new t.Point(this.x,this.y)}}(MOD3),function(t){t.Matrix=function(t,e,i,o){this.m11=1,this.m12=0,this.m21=0,this.m22=1,"undefined"!=typeof t&&(this.m11=t),"undefined"!=typeof e&&(this.m12=e),"undefined"!=typeof i&&(this.m21=i),"undefined"!=typeof o&&(this.m22=o)},t.Matrix.prototype.rotate=function(t){var e=Math.cos(t),i=Math.sin(t);return this.m11=e,this.m12=-i,this.m21=i,this.m22=e,this},t.Matrix.prototype.scale=function(t,e){return this.m12=0,this.m21=0,"undefined"!=typeof t&&(this.m11=t,this.m22=t),"undefined"!=typeof e&&(this.m22=e),this},t.Matrix.prototype.multiply=function(t){var e=this.m11,i=this.m12,o=this.m21,n=this.m22,r=t.m11,s=t.m12,h=t.m21,a=t.m22;return this.m11=e*r+i*h,this.m12=e*s+i*a,this.m21=o*r+n*h,this.m22=o*s+n*a,this},t.Matrix.prototype.transformPoint=function(e){var i=this.m11*e.x+this.m12*e.y,o=this.m21*e.x+this.m22*e.y;return new t.Point(i,o)}}(MOD3),function(t){t.Vector3=function(t,e,i){this.x=null,this.y=null,this.z=null,this.x=t,this.y=e,this.z=i},t.Vector3.ZERO=function(){return new t.Vector3(0,0,0)},t.Vector3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.Vector3.prototype.clone=function(){return new t.Vector3(this.x,this.y,this.z)},t.Vector3.prototype.equals=function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z},t.Vector3.prototype.zero=function(){this.x=this.y=this.z=0},t.Vector3.prototype.negate=function(){return new t.Vector3(-this.x,-this.y,-this.z)},t.Vector3.prototype.add=function(e){return new t.Vector3(this.x+e.x,this.y+e.y,this.z+e.z)},t.Vector3.prototype.subtract=function(e){return new t.Vector3(this.x-e.x,this.y-e.y,this.z-e.z)},t.Vector3.prototype.multiplyScalar=function(e){return new t.Vector3(this.x*e,this.y*e,this.z*e)},t.Vector3.prototype.multiply=function(e){return new t.Vector3(this.x*e.x,this.y*e.y,this.z*e.z)},t.Vector3.prototype.divide=function(e){var i=1/e;return new t.Vector3(this.x*i,this.y*i,this.z*i)},t.Vector3.prototype.normalize=function(){var t=this.x,e=this.y,i=this.z,o=t*t+e*e+i*i;if(o>0){var n=1/Math.sqrt(o);this.x*=n,this.y*=n,this.z*=n}},t.Vector3.prototype.getMagnitude=function(){var t=this.x,e=this.y,i=this.z;return Math.sqrt(t*t+e*e+i*i)},t.Vector3.prototype.setMagnitude=function(t){this.normalize(),this.x*=t,this.y*=t,this.z*=t},t.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"},t.Vector3.prototype.sum=function(t,e){return t.add(e)},t.Vector3.prototype.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.Vector3.prototype.cross=function(e,i){var o=e.x,n=e.y,r=e.z,s=i.x,h=i.y,a=i.z;return new t.Vector3(n*a-r*h,r*s-o*a,o*h-n*s)},t.Vector3.prototype.distance=function(t,e){var i=t.x-e.x,o=t.y-e.y,n=t.z-e.z;return Math.sqrt(i*i+o*o+n*n)}}(MOD3),function(t){t.Matrix4=function(t,e,i,o,n,r,s,h,a,p,u,c,f,y,x,d){this.n11=1,this.n12=0,this.n13=0,this.n14=0,this.n21=0,this.n22=1,this.n23=0,this.n24=0,this.n31=0,this.n32=0,this.n33=1,this.n34=0,this.n41=0,this.n42=0,this.n43=0,this.n44=1,"undefined"!=typeof t&&(this.n11=t),"undefined"!=typeof e&&(this.n12=e),"undefined"!=typeof i&&(this.n13=i),"undefined"!=typeof o&&(this.n14=o),"undefined"!=typeof n&&(this.n21=n),"undefined"!=typeof r&&(this.n22=r),"undefined"!=typeof s&&(this.n23=s),"undefined"!=typeof h&&(this.n24=h),"undefined"!=typeof a&&(this.n31=a),"undefined"!=typeof p&&(this.n32=p),"undefined"!=typeof u&&(this.n33=u),"undefined"!=typeof c&&(this.n34=c),"undefined"!=typeof f&&(this.n41=f),"undefined"!=typeof y&&(this.n42=y),"undefined"!=typeof x&&(this.n43=x),"undefined"!=typeof d&&(this.n44=d)},t.Matrix4.prototype.translationMatrix=function(t,e,i){return this.n14=t,this.n24=e,this.n34=i,this},t.Matrix4.prototype.scaleMatrix=function(t,e,i){return this.n11=t,this.n22=e,this.n33=i,this},t.Matrix4.prototype.rotationMatrix=function(t,e,i,o){var n=Math.cos(o),r=Math.sin(o),s=1-n,h=t*e*s,a=e*i*s,p=t*i*s,u=r*i,c=r*e,f=r*t;return this.n11=n+t*t*s,this.n12=-u+h,this.n13=c+p,this.n14=0,this.n21=u+h,this.n22=n+e*e*s,this.n23=-f+a,this.n24=0,this.n31=-c+p,this.n32=f+a,this.n33=n+i*i*s,this.n34=0,this},t.Matrix4.prototype.calculateMultiply=function(t,e){var i=t.n11,o=e.n11,n=t.n21,r=e.n21,s=t.n31,h=e.n31,a=t.n12,p=e.n12,u=t.n22,c=e.n22,f=t.n32,y=e.n32,x=t.n13,d=e.n13,l=t.n23,M=e.n23,g=t.n33,V=e.n33,m=t.n14,v=e.n14,P=t.n24,w=e.n24,C=t.n34,b=e.n34;this.n11=i*o+a*r+x*h,this.n12=i*p+a*c+x*y,this.n13=i*d+a*M+x*V,this.n14=i*v+a*w+x*b+m,this.n21=n*o+u*r+l*h,this.n22=n*p+u*c+l*y,this.n23=n*d+u*M+l*V,this.n24=n*v+u*w+l*b+P,this.n31=s*o+f*r+g*h,this.n32=s*p+f*c+g*y,this.n33=s*d+f*M+g*V,this.n34=s*v+f*w+g*b+C},t.Matrix4.prototype.multiply=function(t,e){return this.calculateMultiply(t,e),this},t.Matrix4.prototype.multiplyVector=function(t,e){var i=e.x,o=e.y,n=e.z;e.x=i*t.n11+o*t.n12+n*t.n13+t.n14,e.y=i*t.n21+o*t.n22+n*t.n23+t.n24,e.z=i*t.n31+o*t.n32+n*t.n33+t.n34}}(MOD3),function(t){t.VertexProxy=function(t){this.ratioX=null,this.ratioY=null,this.ratioZ=null,this.originalX=null,this.originalY=null,this.originalZ=null,"undefined"!=typeof t&&(this.vertex=t)},t.VertexProxy.prototype.setVertex=function(){},t.VertexProxy.prototype.setRatios=function(t,e,i){this.ratioX=t,this.ratioY=e,this.ratioZ=i},t.VertexProxy.prototype.setOriginalPosition=function(t,e,i){this.originalX=t,this.originalY=e,this.originalZ=i},t.VertexProxy.prototype.getX=function(){},t.VertexProxy.prototype.getY=function(){},t.VertexProxy.prototype.getZ=function(){},t.VertexProxy.prototype.setX=function(){},t.VertexProxy.prototype.setY=function(){},t.VertexProxy.prototype.setZ=function(){},t.VertexProxy.prototype.getValue=function(e){switch(e){case t.ModConstant.X:return this.getX();case t.ModConstant.Y:return this.getY();case t.ModConstant.Z:return this.getZ()}return 0},t.VertexProxy.prototype.setValue=function(e,i){switch(e){case t.ModConstant.X:this.setX(i);break;case t.ModConstant.Y:this.setY(i);break;case t.ModConstant.Z:this.setZ(i)}},t.VertexProxy.prototype.getRatio=function(e){switch(e){case t.ModConstant.X:return this.ratioX;case t.ModConstant.Y:return this.ratioY;case t.ModConstant.Z:return this.ratioZ}return-1},t.VertexProxy.prototype.getOriginalValue=function(e){switch(e){case t.ModConstant.X:return this.originalX;case t.ModConstant.Y:return this.originalY;case t.ModConstant.Z:return this.originalZ}return 0},t.VertexProxy.prototype.reset=function(){this.setX(this.originalX),this.setY(this.originalY),this.setZ(this.originalZ)},t.VertexProxy.prototype.collapse=function(){this.originalX=this.getX(),this.originalY=this.getY(),this.originalZ=this.getZ()},t.VertexProxy.prototype.getVector=function(){return new t.Vector3(this.getX(),this.getY(),this.getZ())},t.VertexProxy.prototype.setVector=function(t){this.setX(t.x),this.setY(t.y),this.setZ(t.z)},t.VertexProxy.prototype.getRatioVector=function(){return new t.Vector3(this.ratioX,this.ratioY,this.ratioZ)}}(MOD3),function(t){t.FaceProxy=function(){this.vertices=[]},t.FaceProxy.prototype.addVertex=function(t){this.vertices.push(t)},t.FaceProxy.prototype.getVertices=function(){return this.vertices}}(MOD3),function(t){t.MeshProxy=function(){this.maxX=null,this.maxY=null,this.maxZ=null,this.minX=null,this.minY=null,this.minZ=null,this.maxAxis=null,this.midAxis=null,this.minAxis=null,this.width=null,this.height=null,this.depth=null,this.vertices=[],this.faces=[],this.mesh=null},t.MeshProxy.prototype.getVertices=function(){return this.vertices},t.MeshProxy.prototype.getFaces=function(){return this.faces},t.MeshProxy.prototype.analyzeGeometry=function(){for(var e,i,o,n,r,s,h,a,p,u,c,f,y=this.getVertices(),x=y.length,d=x,l=!0,M=Math.min,g=Math.max;--d>=0;)e=y[d],i=e.getX(),o=e.getY(),n=e.getZ(),l?(r=s=i,h=a=o,p=u=n,l=!1):(r=M(r,i),h=M(h,o),p=M(p,n),s=g(s,i),a=g(a,o),u=g(u,n)),e.setOriginalPosition(i,o,n);c=s-r,f=a-h,depth=u-p,this.width=c,this.height=f,this.depth=depth,this.minX=r,this.maxX=s,this.minY=h,this.maxY=a,this.minZ=p,this.maxZ=u;var V=g(c,g(f,depth)),m=M(c,M(f,depth));for(V==c&&m==f?(this.minAxis=t.ModConstant.Y,this.midAxis=t.ModConstant.Z,this.maxAxis=t.ModConstant.X):V==c&&m==depth?(this.minAxis=t.ModConstant.Z,this.midAxis=t.ModConstant.Y,this.maxAxis=t.ModConstant.X):V==f&&m==c?(this.minAxis=t.ModConstant.X,this.midAxis=t.ModConstant.Z,this.maxAxis=t.ModConstant.Y):V==f&&m==depth?(this.minAxis=t.ModConstant.Z,this.midAxis=t.ModConstant.X,this.maxAxis=t.ModConstant.Y):V==depth&&m==c?(this.minAxis=t.ModConstant.X,this.midAxis=t.ModConstant.Y,this.maxAxis=t.ModConstant.Z):V==depth&&m==f&&(this.minAxis=t.ModConstant.Y,this.midAxis=t.ModConstant.X,this.maxAxis=t.ModConstant.Z),d=x;--d>=0;)e=y[d],e.setRatios((e.getX()-r)/c,(e.getY()-h)/f,(e.getZ()-p)/depth)},t.MeshProxy.prototype.resetGeometry=function(){for(var t=this.getVertices(),e=t.length;--e>=0;)t[e].reset()},t.MeshProxy.prototype.collapseGeometry=function(){for(var t=this.getVertices(),e=t.length;--e>=0;)t[e].collapse();this.analyzeGeometry()},t.MeshProxy.prototype.getMin=function(e){switch(e){case t.ModConstant.X:return this.minX;case t.ModConstant.Y:return this.minY;case t.ModConstant.Z:return this.minZ}return-1},t.MeshProxy.prototype.getMax=function(e){switch(e){case t.ModConstant.X:return this.maxX;case t.ModConstant.Y:return this.maxY;case t.ModConstant.Z:return this.maxZ}return-1},t.MeshProxy.prototype.getSize=function(e){switch(e){case t.ModConstant.X:return this.width;case t.ModConstant.Y:return this.height;case t.ModConstant.Z:return this.depth}return-1},t.MeshProxy.prototype.setMesh=function(t){this.mesh=t,this.vertices=[],this.faces=[]},t.MeshProxy.prototype.postApply=function(){},t.MeshProxy.prototype.updateMeshPosition=function(){}}(MOD3),function(t){t.Modifier=function(){this.mod=null},t.Modifier.prototype.setModifiable=function(t){this.mod=t},t.Modifier.prototype.getVertices=function(){return this.mod.getVertices()},t.Modifier.prototype.apply=function(){}}(MOD3),function(t){t.Library3d=function(){this.id="",this.meshClass=null,this.vertexClass=null}}(MOD3),function(t){t.PluginFactory={},t.PluginFactory.getMeshProxy=function(t){var e=t.meshClass;return new e}}(MOD3),function(t){t.ModifierStack=function(e,i){this.lib3d=e,this.baseMesh=null,this.stack=null,this.baseMesh=t.PluginFactory.getMeshProxy(e),this.baseMesh.setMesh(i),this.baseMesh.analyzeGeometry(),this.stack=[]},t.ModifierStack.prototype.addModifier=function(t){t.setModifiable(this.baseMesh),this.stack.push(t)},t.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var t=this.stack,e=t.length,i=0;e>i;)t[i++].apply();this.baseMesh.postApply()},t.ModifierStack.prototype.collapse=function(){this.apply(),this.baseMesh.collapseGeometry(),this.stack=[]},t.ModifierStack.prototype.clear=function(){this.stack=[]},t.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh}}(MOD3),function(t){t.Pivot=function(e,i,o){this.pivot=new t.Vector3(e,i,o)},t.Pivot.prototype=new t.Modifier,t.Pivot.prototype.constructor=t.Pivot,t.Pivot.prototype.setMeshCenter=function(){var e=this.mod;this.pivot=new t.Vector3(-(e.minX+.5*e.width),-(e.minY+.5*e.height),-(e.minZ+.5*e.depth))},t.Pivot.prototype.apply=function(){for(var t,e,i,o=this.mod.getVertices(),n=o.length,r=this.pivot;--n>=0;)e=o[n],i=e.getVector().clone(),e.setVector(i.add(r));t=r.clone(),this.mod.updateMeshPosition(t.negate())}}(MOD3),function(t){t.Bend=function(e,i,o){this.force=null,this.offset=null,this.angle=null,this.diagAngle=null,this.constraint=t.ModConstant.NONE,this.max=null,this.min=null,this.mid=null,this.width=null,this.height=null,this.origin=null,this.m1=null,this.m2=null,this.switchAxes=!1,this.force=e,this.offset=i,this.setAngle(o)},t.Bend.prototype=new t.Modifier,t.Bend.prototype.constructor=t.Bend,t.Bend.prototype.setAngle=function(e){this.angle=e,this.m1=new t.Matrix,this.m1.rotate(e),this.m2=new t.Matrix,this.m2.rotate(-e)},t.Bend.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis,this.min=this.mod.minAxis,this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis,this.width=this.mod.getSize(this.max),this.height=this.mod.getSize(this.mid),this.origin=this.mod.getMin(this.max),this.diagAngle=Math.atan(this.width/this.height)},t.Bend.prototype.apply=function(){if(0!=this.force)for(var e,i,o,n,r,s,h,a,p,u,c=this.mod.getVertices(),f=c.length,y=this.width,x=this.offset,d=this.origin,l=this.force,M=this.max,g=this.min,V=this.mid,m=this.m1,v=this.m2,P=d+y*x,w=y/Math.PI/l,C=t.Constants.doublePI*(y/(w*t.Constants.doublePI)),b=1/y,D=t.Constants.halfPI,X=Math.sin,Z=Math.cos;--f>=0;)e=c[f],i=e.getValue(M),o=e.getValue(V),n=e.getValue(g),r=m.transformPoint(new t.Point(i,o)),i=r.x,o=r.y,s=(i-d)*b,this.constraint==t.ModConstant.LEFT&&x>=s||this.constraint==t.ModConstant.RIGHT&&s>=x||(h=D-C*x+C*s,a=X(h)*(w+n),p=Z(h)*(w+n),n=a-w,i=P-p),u=v.transformPoint(new t.Point(i,o)),i=u.x,o=u.y,e.setValue(M,i),e.setValue(V,o),e.setValue(g,n)}}(MOD3),function(t){t.Bloat=function(){this.center=t.Vector3.ZERO(),this.radius=0,this.a=.01,this.u=t.Vector3.ZERO()},t.Bloat.prototype=new t.Modifier,t.Bloat.prototype.constructor=t.Bloat,t.Bloat.prototype.setRadius=function(t){this.radius=Math.max(0,t)},t.Bloat.prototype.setA=function(t){this.a=Math.max(0,t)},t.Bloat.prototype.apply=function(){for(var t,e,i=this.mod.getVertices(),o=i.length,n=this.center,r=this.radius,s=this.a;--o>=0;)t=i[o],this.u.x=t.getX()-n.x,this.u.y=t.getY()-n.y,this.u.z=t.getZ()-n.z,e=this.u.getMagnitude(),this.u.setMagnitude(e+r*Math.exp(-e*s)),t.setX(this.u.x+n.x),t.setY(this.u.y+n.y),t.setZ(this.u.z+n.z)}}(MOD3),function(t){t.Twist=function(e){this.vector=new t.Vector3(0,1,0),this.angle=e,this.center=t.Vector3.ZERO()},t.Twist.prototype=new t.Modifier,t.Twist.prototype.constructor=t.Twist,t.Twist.prototype.apply=function(){this.vector.normalize();for(var e,i,o=this.mod,n=o.getVertices(),r=n.length,s=this.vector,h=this.angle,a=this.center,p=new t.Vector3(.5*o.maxX,.5*o.maxY,.5*o.maxZ),u=1/p.getMagnitude(),c=u*h,f=-t.Vector3.dot(s,a);--r>=0;)e=n[r],i=e.getX()*s.x+e.getY()*s.y+e.getZ()*s.z+f,this.twistPoint(e,i*c)},t.Twist.prototype.twistPoint=function(e,i){var o=(new t.Matrix4).translationMatrix(e.getX(),e.getY(),e.getZ());o=(new t.Matrix4).multiply((new t.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,i),o),e.setX(o.n14),e.setY(o.n24),e.setZ(o.n34)}}(MOD3),function(t){t.Skew=function(e){this.force=0,this.skewAxis=null,"undefined"!=typeof e&&(this.force=e),this.offset=.5,this.constraint=t.ModConstant.NONE,this.power=1,this.falloff=1,this.inverseFalloff=!1,this.oneSide=!1,this.swapAxes=!1},t.Skew.prototype=new t.Modifier,t.Skew.prototype.constructor=t.Skew,t.Skew.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.skewAxis=this.skewAxis||this.mod.maxAxis},t.Skew.prototype.apply=function(){for(var e,i,o,n,r,s,h=this.mod.getVertices(),a=h.length,p=this.constraint,u=this.skewAxis,c=this.offset,f=this.oneSide,y=this.inverseFalloff,x=this.falloff,d=1-x,l=this.power,M=this.force,g=this.getDisplaceAxis();--a>=0;)e=h[a],p==t.ModConstant.LEFT&&e.getRatio(u)<=c||p==t.ModConstant.RIGHT&&e.getRatio(u)>c||(i=e.getRatio(u)-c,f&&(i=Math.abs(i)),o=e.getRatio(g),y&&(o=1-o),n=x+o*d,r=Math.pow(Math.abs(i),l)*t.XMath.sign(i,1),s=e.getValue(g)+M*r*n,e.setValue(g,s))},t.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case t.ModConstant.X:return this.swapAxes?t.ModConstant.Z:t.ModConstant.Y;case t.ModConstant.Y:return this.swapAxes?t.ModConstant.Z:t.ModConstant.X;case t.ModConstant.Z:return this.swapAxes?t.ModConstant.Y:t.ModConstant.X;default:return 0}}}(MOD3),function(t){t.Taper=function(e){this.force=null,this.power=null,this.start=0,this.end=1,this.vector=new t.Vector3(1,0,1),this.vector2=new t.Vector3(0,1,0),"undefined"!=typeof e&&(this.force=e),this.power=1},t.Taper.prototype=new t.Modifier,t.Taper.prototype.constructor=t.Taper,t.Taper.prototype.setFalloff=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Taper.prototype.apply=function(){for(var e,i,o,n,r,s=this.mod.getVertices(),h=s.length,a=this.vector,p=this.vector2,u=this.force,c=this.power;--h>=0;)e=s[h],i=e.getRatioVector().multiply(p),o=u*Math.pow(i.getMagnitude(),c),n=(new t.Matrix4).scaleMatrix(1+o*a.x,1+o*a.y,1+o*a.z),r=e.getVector(),(new t.Matrix4).multiplyVector(n,r),e.setVector(r)}}(MOD3),function(t){1/Math.PI,2*Math.PI,t.Wheel=function(){this.speed=null,this.turn=null,this.roll=null,this.radius=null,this.steerVector=new t.Vector3(0,1,0),this.rollVector=new t.Vector3(0,0,1),this.speed=0,this.turn=0,this.roll=0},t.Wheel.prototype=new t.Modifier,t.Wheel.prototype.constructor=t.Wheel,t.Wheel.prototype.setModifiable=function(e){t.Modifier.prototype.setModifiable.call(this,e),this.radius=.5*this.mod.width},t.Wheel.prototype.apply=function(){this.roll+=this.speed;var e,i,o,n,r,s=this.mod.getVertices(),h=s.length,a=this.steerVector,p=this.turn,u=this.rollVector,c=this.roll;for(0!=p?(i=(new t.Matrix4).rotationMatrix(a.x,a.y,a.z,p),o=u.clone(),(new t.Matrix4).multiplyVector(i,o),e=(new t.Matrix4).rotationMatrix(o.x,o.y,o.z,c)):e=(new t.Matrix4).rotationMatrix(u.x,u.y,u.z,c);--h>=0;)n=s[h],r=n.getVector().clone(),0!=p&&(new t.Matrix4).multiplyVector(i,r),(new t.Matrix4).multiplyVector(e,r),n.setX(r.x),n.setY(r.y),n.setZ(r.z)},t.Wheel.prototype.getStep=function(){return this.radius*this.speed*t.Constants.invPI},t.Wheel.prototype.getPerimeter=function(){return this.radius*t.Constants.doublePI}}(MOD3),function(t){t.Break=function(e,i){this.bv=new t.Vector3(0,1,0),this.offset=0,this.angle=0,"undefined"!=typeof e&&(this.offset=e),"undefined"!=typeof i&&(this.angle=i),this.range=new t.Range(0,1)},t.Break.prototype=new t.Modifier,t.Break.prototype.constructor=t.Break,t.Break.prototype.apply=function(){var e,i,o,n,r,s=this.mod,h=s.getVertices(),a=h.length,p=this.offset,u=this.range,c=this.angle,f=this.bv;for(e=new t.Vector3(0,0,-(s.minZ+s.depth*p)),i=e.negate(),r=(new t.Matrix4).rotationMatrix(f.x,f.y,f.z,c);--a>=0;)o=h[a],n=o.getVector(),n=n.add(e),n.z>=0&&u.isIn(o.ratioY)&&(new t.Matrix4).multiplyVector(r,n),n=n.add(i),o.setX(n.x),o.setY(n.y),o.setZ(n.z)}}(MOD3),function(t){t.Noise=function(e){this.force=0,this.axc=t.ModConstant.NONE,this.start=0,this.end=0,"undefined"!=typeof e&&(this.force=e)},t.Noise.prototype=new t.Modifier,t.Noise.prototype.constructor=t.Noise,t.Noise.prototype.constraintAxes=function(t){this.axc=t},t.Noise.prototype.setFalloff=function(t,e){this.start=0,this.end=1,"undefined"!=typeof t&&(this.start=t),"undefined"!=typeof e&&(this.end=e)},t.Noise.prototype.apply=function(){for(var t,e,i,o=this.mod,n=this.axc,r=this.start,s=this.end,h=o.getVertices(),a=h.length,p=this.force,u=.5*p,c=Math.random;--a>=0;)t=h[a],e=c()*p-u,i=t.getRatio(o.maxAxis),s>r?(r>i&&(i=0),i>s&&(i=1)):r>s?(i=1-i,i>r&&(i=0),s>i&&(i=1)):i=1,1&n||t.setX(t.getX()+e*i),1&n>>1||t.setY(t.getY()+e*i),1&n>>2||t.setZ(t.getZ()+e*i)}}(MOD3),function(t){t.LibraryThree=function(){this.id="Three.js",this.meshClass=t.MeshThree,this.vertexClass=t.VertexThree},t.LibraryThree.prototype=new t.Library3d,t.LibraryThree.prototype.constructor=t.LibraryThree}(MOD3),function(t){t.VertexThree=function(t){this.mesh=t},t.VertexThree.prototype=new t.VertexProxy,t.VertexThree.prototype.constructor=t.VertexThree,t.VertexThree.prototype.setVertex=function(t){this.vertex=t,this.originalX=t.x,this.originalY=t.y,this.originalZ=t.z},t.VertexThree.prototype.getX=function(){return this.vertex.x},t.VertexThree.prototype.getY=function(){return this.vertex.y},t.VertexThree.prototype.getZ=function(){return this.vertex.z},t.VertexThree.prototype.setX=function(t){if(t!=this.vertex.x){var e=this.mesh;e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.buffersNeedUpdate=!0,e.geometry.dynamic=!0}this.vertex.x=t},t.VertexThree.prototype.setY=function(t){if(t!=this.vertex.y){var e=this.mesh;e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.buffersNeedUpdate=!0,e.geometry.dynamic=!0}this.vertex.y=t},t.VertexThree.prototype.setZ=function(t){if(t!=this.vertex.z){var e=this.mesh;e.geometry.verticesNeedUpdate=!0,e.geometry.normalsNeedUpdate=!0,e.geometry.buffersNeedUpdate=!0,e.geometry.dynamic=!0}this.vertex.z=t}}(MOD3),function(t){t.MeshThree=function(){},t.MeshThree.prototype=new t.MeshProxy,t.MeshThree.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);var i,o,n=[],r=0,s=this.mesh.geometry.vertices,h=s.length,a=this.mesh.geometry.faces,p=a.length;for(r=0;h>r;)i=new t.VertexThree(this.mesh),i.setVertex(s[r]),this.vertices.push(i),n[s[r]]=i,r++;for(r=0;p>r;)o=new t.FaceProxy,a[r]instanceof THREE.Face3?(o.addVertex(n[s[a[r].a]]),o.addVertex(n[s[a[r].b]]),o.addVertex(n[s[a[r].c]])):a[r]instanceof THREE.Face4&&(o.addVertex(n[s[a[r].a]]),o.addVertex(n[s[a[r].b]]),o.addVertex(n[s[a[r].c]]),o.addVertex(n[s[a[r].d]])),this.faces.push(o),r++;delete lookup},t.MeshThree.prototype.updateMeshPosition=function(t){var e=this.mesh;e.position.x+=t.x,e.position.y+=t.y,e.position.z+=t.z}}(MOD3),function(t){t.LibraryPre3D=function(){this.id="pre3d.js",this.meshClass=t.MeshPre3D,this.vertexClass=t.VertexPre3D},t.LibraryThree.prototype=new t.Library3d,t.LibraryThree.prototype.constructor=t.LibraryPre3D}(MOD3),function(t){t.VertexPre3D=function(){},t.VertexPre3D.prototype=new t.VertexProxy,t.VertexPre3D.prototype.constructor=t.VertexPre3D,t.VertexPre3D.prototype.setVertex=function(t){this.vertex=t,this.originalX=t.x,this.originalY=t.y,this.originalZ=t.z},t.VertexPre3D.prototype.getX=function(){return this.vertex.x},t.VertexPre3D.prototype.getY=function(){return this.vertex.y},t.VertexPre3D.prototype.getZ=function(){return this.vertex.z},t.VertexPre3D.prototype.setX=function(t){this.vertex.x=t},t.VertexPre3D.prototype.setY=function(t){this.vertex.y=t},t.VertexPre3D.prototype.setZ=function(t){this.vertex.z=t}}(MOD3),function(t){t.MeshPre3D=function(){},t.MeshPre3D.prototype=new t.MeshProxy,t.MeshPre3D.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var i=[],o=this.mesh.vertices,n=this.mesh.quads,r=o.length,s=n.length,h=0;r>h;h++){var a=new t.VertexPre3D;a.setVertex(o[h]),this.vertices.push(a),i[o[h]]=a}for(h=0;s>h;h++){var p=new t.FaceProxy;n[h]instanceof Pre3d.QuadFace&&(p.addVertex(i[o[n[h].i0]]),p.addVertex(i[o[n[h].i1]]),p.addVertex(i[o[n[h].i2]]),null!=n[h].i3&&p.addVertex(i[o[n[h].i3]])),this.faces.push(p)}delete lookup},t.MeshPre3D.prototype.updateMeshPosition=function(){}}(MOD3),function(t){t.LibraryJ3D=function(){this.id="J3D",this.meshClass=t.MeshJ3D,this.vertexClass=t.VertexJ3D},t.LibraryJ3D.prototype=new t.Library3d,t.LibraryJ3D.prototype.constructor=t.LibraryJ3D}(MOD3),function(t){t.VertexJ3D=function(t){this.geometry=t},t.VertexJ3D.prototype=new t.VertexProxy,t.VertexJ3D.prototype.constructor=t.VertexJ3D,t.VertexJ3D.prototype.setVertex=function(t){this.vertex=t;var e=this.geometry;this.originalX=e.vertexPositionBuffer.data[t],this.originalY=e.vertexPositionBuffer.data[t+1],this.originalZ=e.vertexPositionBuffer.data[t+2]},t.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]},t.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+1]},t.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]},t.VertexJ3D.prototype.setX=function(t){var e=this.vertex,i=this.geometry,o=i.vertexPositionBuffer.data[e];i.vertexPositionBuffer.data[e]=t,o!=t&&i.replaceArray(i.vertexPositionBuffer,i.vertexPositionBuffer.data)},t.VertexJ3D.prototype.setY=function(t){var e=this.vertex,i=this.geometry,o=i.vertexPositionBuffer.data[e+1];i.vertexPositionBuffer.data[e+1]=t,o!=t&&i.replaceArray(i.vertexPositionBuffer,i.vertexPositionBuffer.data)},t.VertexJ3D.prototype.setZ=function(t){var e=this.vertex,i=this.geometry,o=i.vertexPositionBuffer.data[e+2];i.vertexPositionBuffer.data[e+2]=t,o!=t&&i.replaceArray(i.vertexPositionBuffer,i.vertexPositionBuffer.data)}}(MOD3),function(t){t.MeshJ3D=function(){},t.MeshJ3D.prototype=new t.MeshProxy,t.MeshJ3D.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);var i,o=0,n=e.geometry.vertexPositionBuffer.data,r=n.length,s=e.geometry.vertexPositionBuffer.itemSize;for(o=0;r>o;)i=new t.VertexJ3D(e.geometry),i.setVertex(o),this.vertices.push(i),o+=s;this.faces=null},t.MeshJ3D.prototype.updateMeshPosition=function(t){var e=this.mesh;e.position.x+=t.x,e.position.y+=t.y,e.position.z+=t.z}}(MOD3),function(t){t.LibraryCopperlicht=function(){this.id="Copperlicht",this.meshClass=t.MeshCopperlicht,this.vertexClass=t.VertexCopperlicht},t.LibraryCopperlicht.prototype=new t.Library3d,t.LibraryCopperlicht.prototype.constructor=t.LibraryCopperlicht}(MOD3),function(t){t.VertexCopperlicht=function(t,e){this.node=t,this.buffer=e},t.VertexCopperlicht.prototype=new t.VertexProxy,t.VertexCopperlicht.prototype.constructor=t.VertexCopperlicht,t.VertexCopperlicht.prototype.setVertex=function(t){this.vertex=t,this.originalX=this.vertex.Pos.X,this.originalY=this.vertex.Pos.Y,this.originalZ=this.vertex.Pos.Z},t.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X},t.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y},t.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z},t.VertexCopperlicht.prototype.setX=function(t){var e=this.vertex.Pos.X;this.vertex.Pos.X=t,e!=t&&this.buffer.update(!0)},t.VertexCopperlicht.prototype.setY=function(t){var e=this.vertex.Pos.Y;this.vertex.Pos.Y=t,e!=t&&this.buffer.update(!0)},t.VertexCopperlicht.prototype.setZ=function(t){var e=this.vertex.Pos.Z;this.vertex.Pos.Z=t,e!=t&&this.buffer.update(!0)}}(MOD3),function(t){t.MeshCopperlicht=function(){},t.MeshCopperlicht.prototype=new t.MeshProxy,t.MeshCopperlicht.prototype.setMesh=function(e){t.MeshProxy.prototype.setMesh.call(this,e);for(var i=this.mesh.getMesh().GetMeshBuffers(),o=[],n=0;n<i.length;n++){o=i[n].Vertices;for(var r=o.length,s=0;r>s;s++){var h=new t.VertexCopperlicht(this.mesh,i[n]);h.setVertex(o[s]),this.vertices.push(h)}}this.faces=null,delete lookup},t.MeshCopperlicht.prototype.updateMeshPosition=function(t){this.mesh.Pos.X+=t.x,this.mesh.Pos.Y+=t.y,this.mesh.Pos.Z+=t.z}}(MOD3),function(t){t.LibraryCubicVR=function(){this.id="CubicVR.js",this.meshClass=t.MeshCubicVR,this.vertexClass=t.VertexCubicVR},t.LibraryCubicVR.prototype=new t.Library3d,t.LibraryCubicVR.prototype.constructor=t.LibraryCubicVR}(MOD3),function(t){t.VertexCubicVR=function(t){this.sceneObject=t},t.VertexCubicVR.prototype=new t.VertexProxy,t.VertexCubicVR.prototype.constructor=t.VertexCubicVR,t.VertexCubicVR.prototype.setVertex=function(t){this.vertex=t,this.originalX=t[0],this.originalY=t[1],this.originalZ=t[2]},t.VertexCubicVR.prototype.getX=function(){return this.vertex[0]},t.VertexCubicVR.prototype.getY=function(){return this.vertex[1]},t.VertexCubicVR.prototype.getZ=function(){return this.vertex[2]},t.VertexCubicVR.prototype.setX=function(t){t!=this.vertex[0]&&(this.sceneObject.dirty=!0),this.vertex[0]=t},t.VertexCubicVR.prototype.setY=function(t){t!=this.vertex[1]&&(this.sceneObject.dirty=!0),this.vertex[1]=t},t.VertexCubicVR.prototype.setZ=function(t){t!=this.vertex[2]&&(this.sceneObject.dirty=!0),this.vertex[2]=t}}(MOD3),function(t){t.MeshCubicVR=function(){},t.MeshCubicVR.prototype=new t.MeshProxy,t.MeshCubicVR.prototype.setMesh=function(e){this.sceneObject=e,t.MeshProxy.prototype.setMesh.call(this,e.obj);var i,o,n=[],r=0,s=e.obj.points,h=s.length,a=e.obj.faces,p=a.length;for(r=0;h>r;)i=new t.VertexCubicVR(e),i.setVertex(s[r]),this.vertices.push(i),n[s[r]]=i,r++;for(r=0;p>r;){o=new t.FaceProxy;for(var u=0,c=a[r].points.length;c>u;u++)o.addVertex(n[s[a[r].points[u]]]);this.faces.push(o),r++}delete lookup},t.MeshCubicVR.prototype.updateMeshPosition=function(t){this.sceneObject.position[0]+=t[0],this.sceneObject.position[1]+=t[1],this.sceneObject.position[2]+=t[2]}}(MOD3);