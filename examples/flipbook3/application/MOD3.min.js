/**
*
* http://github.com/foo123/MOD3
*
* MOD3 3D Modifier Library (port of actionscript AS3Mod to javascript)
* supports: THREE.js, J3D, Copperlicht, Pre3D
*
* @author Nikos M.
* @url http://nikos-web-development.netai.net/
*
**/
var MOD3=MOD3||{};(function(a){a.ModConstant={LEFT:-1,RIGHT:1,NONE:0,X:1,Y:2,Z:4}})(MOD3);
(function(a){a.XMath={};a.XMath.normalize=function(d,b,c){return b-d==0?1:a.XMath.trim(0,1,(c-d)/b)};a.XMath.toRange=function(a,b,c){return b-a==0?0:a+(b-a)*c};a.XMath.inInRange=function(a,b,c,e){typeof e=="undefined"&&(e=!1);return e?c>=a&&c<=b:c>a&&c<b};a.XMath.sign=function(a,b){typeof b=="undefined"&&(b=0);return a==0?b:a>0?1:-1};a.XMath.trim=function(a,b,c){return Math.min(b,Math.max(a,c))};a.XMath.wrap=function(a,b,c){return c<a?c+(b-a):c>=b?c-(b-a):c};a.XMath.degToRad=function(a){return a/
180*Math.PI};a.XMath.radToDeg=function(a){return a/Math.PI*180};a.XMath.presicion=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c};a.XMath.uceil=function(a){return a<0?Math.floor(a):Math.ceil(a)}})(MOD3);
(function(a){a.Range=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Range.prototype.getSize=function(){return this.end-this.start};a.Range.prototype.move=function(a){this.start+=a;this.end+=a};a.Range.prototype.isIn=function(a){return a>=this.start&&a<=this.end};a.Range.prototype.normalize=function(d){return a.XMath.normalize(this.start,this.end,d)};a.Range.prototype.toRange=function(d){return a.XMath.toRange(this.start,this.end,
d)};a.Range.prototype.trim=function(d){return a.XMath.trim(this.start,this.end,d)};a.Range.prototype.interpolate=function(a,b){return this.toRange(b.normalize(a))};a.Range.prototype.toString=function(){return"["+this.start+" - "+this.end+"]"}})(MOD3);
(function(a){a.Phase=function(a){this.value=0;if(typeof a!="undefined")this.value=a};a.Phase.prototype.getPhasedValue=function(){return Math.sin(this.value)};a.Phase.prototype.getAbsPhasedValue=function(){return Math.abs(this.getPhasedValue())};a.Phase.prototype.getNormValue=function(){return(this.getPhasedValue()+1)*0.5}})(MOD3);
(function(a){a.Point=function(a,b){this.y=this.x=0;if(typeof a!="undefined")this.x=a;if(typeof b!="undefined")this.y=b};a.Point.prototype.clone=function(){return new a.Point(this.x,this.y)}})(MOD3);
(function(a){a.Matrix=function(a,b,c,e){this.m11=1;this.m21=this.m12=0;this.m22=1;if(typeof a!="undefined")this.m11=a;if(typeof b!="undefined")this.m12=b;if(typeof c!="undefined")this.m21=c;if(typeof e!="undefined")this.m22=e};a.Matrix.prototype.rotate=function(a){var b=Math.cos(a),a=Math.sin(a);this.m11=b;this.m12=-a;this.m21=a;this.m22=b;return this};a.Matrix.prototype.scale=function(a,b){this.m21=this.m12=0;if(typeof a!="undefined")this.m22=this.m11=a;if(typeof b!="undefined")this.m22=b;return this};
a.Matrix.prototype.multiply=function(a){var b=this.m11*a.m12+this.m12*a.m22,c=this.m21*a.m11+this.m22*a.m21,e=this.m21*a.m12+this.m22*a.m22;this.m11=this.m11*a.m11+this.m12*a.m21;this.m12=b;this.m21=c;this.m22=e;return this};a.Matrix.prototype.transformPoint=function(d){return new a.Point(this.m11*d.x+this.m12*d.y,this.m21*d.x+this.m22*d.y)}})(MOD3);
(function(a){a.Vector3=function(a,b,c){this.z=this.y=this.x=null;this.x=a;this.y=b;this.z=c};a.Vector3.ZERO=function(){return new a.Vector3(0,0,0)};a.Vector3.prototype.clone=function(){return new a.Vector3(this.x,this.y,this.z)};a.Vector3.prototype.equals=function(a){return this.x==a.x&&this.y==a.y&&this.z==a.z};a.Vector3.prototype.zero=function(){this.x=this.y=this.z=0};a.Vector3.prototype.negate=function(){return new a.Vector3(-this.x,-this.y,-this.z)};a.Vector3.prototype.add=function(d){return new a.Vector3(this.x+
d.x,this.y+d.y,this.z+d.z)};a.Vector3.prototype.subtract=function(d){return new a.Vector3(this.x-d.x,this.y-d.y,this.z-d.z)};a.Vector3.prototype.multiplyScalar=function(d){return new a.Vector3(this.x*d,this.y*d,this.z*d)};a.Vector3.prototype.multiply=function(d){return new a.Vector3(this.x*d.x,this.y*d.y,this.z*d.z)};a.Vector3.prototype.divide=function(d){d=1/d;return new a.Vector3(this.x*d,this.y*d,this.z*d)};a.Vector3.prototype.normalize=function(){var a=this.x*this.x+this.y*this.y+this.z*this.z;
a>0&&(a=1/Math.sqrt(a),this.x*=a,this.y*=a,this.z*=a)};a.Vector3.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};a.Vector3.prototype.setMagnitude=function(a){this.normalize();this.x*=a;this.y*=a;this.z*=a};a.Vector3.prototype.toString=function(){return"["+this.x+" , "+this.y+" , "+this.z+"]"};a.Vector3.prototype.sum=function(a,b){return a.add(b)};a.Vector3.prototype.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z};a.Vector3.prototype.cross=function(d,
b){return new a.Vector3(d.y*b.z-d.z*b.y,d.z*b.x-d.x*b.z,d.x*b.y-d.y*b.x)};a.Vector3.prototype.distance=function(a,b){var c=a.x-b.x,e=a.y-b.y,g=a.z-b.z;return Math.sqrt(c*c+e*e+g*g)}})(MOD3);
(function(a){a.Matrix4=function(a,b,c,e,g,f,h,j,i,l,k,o,m,p,n,q){this.n11=1;this.n21=this.n14=this.n13=this.n12=0;this.n22=1;this.n32=this.n31=this.n24=this.n23=0;this.n33=1;this.n43=this.n42=this.n41=this.n34=0;this.n44=1;if(typeof a!="undefined")this.n11=a;if(typeof b!="undefined")this.n12=b;if(typeof c!="undefined")this.n13=c;if(typeof e!="undefined")this.n14=e;if(typeof g!="undefined")this.n21=g;if(typeof f!="undefined")this.n22=f;if(typeof h!="undefined")this.n23=h;if(typeof j!="undefined")this.n24=
j;if(typeof i!="undefined")this.n31=i;if(typeof l!="undefined")this.n32=l;if(typeof k!="undefined")this.n33=k;if(typeof o!="undefined")this.n34=o;if(typeof m!="undefined")this.n41=m;if(typeof p!="undefined")this.n42=p;if(typeof n!="undefined")this.n43=n;if(typeof q!="undefined")this.n44=q};a.Matrix4.prototype.translationMatrix=function(a,b,c){this.n14=a;this.n24=b;this.n34=c;return this};a.Matrix4.prototype.scaleMatrix=function(a,b,c){this.n11=a;this.n22=b;this.n33=c;return this};a.Matrix4.prototype.rotationMatrix=
function(a,b,c,e){var g=Math.cos(e),f=Math.sin(e),e=1-g,h=a*b*e,j=b*c*e,i=a*c*e,l=f*c,k=f*b;f*=a;this.n11=g+a*a*e;this.n12=-l+h;this.n13=k+i;this.n14=0;this.n21=l+h;this.n22=g+b*b*e;this.n23=-f+j;this.n24=0;this.n31=-k+i;this.n32=f+j;this.n33=g+c*c*e;this.n34=0;return this};a.Matrix4.prototype.calculateMultiply=function(a,b){var c=a.n11,e=b.n11,g=a.n21,f=b.n21,h=a.n31,j=b.n31,i=a.n12,l=b.n12,k=a.n22,o=b.n22,m=a.n32,p=b.n32,n=a.n13,q=b.n13,r=a.n23,t=b.n23,s=a.n33,u=b.n33,y=a.n14,v=b.n14,z=a.n24,w=
b.n24,A=a.n34,x=b.n34;this.n11=c*e+i*f+n*j;this.n12=c*l+i*o+n*p;this.n13=c*q+i*t+n*u;this.n14=c*v+i*w+n*x+y;this.n21=g*e+k*f+r*j;this.n22=g*l+k*o+r*p;this.n23=g*q+k*t+r*u;this.n24=g*v+k*w+r*x+z;this.n31=h*e+m*f+s*j;this.n32=h*l+m*o+s*p;this.n33=h*q+m*t+s*u;this.n34=h*v+m*w+s*x+A};a.Matrix4.prototype.multiply=function(a,b){this.calculateMultiply(a,b);return this};a.Matrix4.prototype.multiplyVector=function(a,b){var c=b.x,e=b.y,g=b.z;b.x=c*a.n11+e*a.n12+g*a.n13+a.n14;b.y=c*a.n21+e*a.n22+g*a.n23+a.n24;
b.z=c*a.n31+e*a.n32+g*a.n33+a.n34}})(MOD3);
(function(a){a.VertexProxy=function(a){this.originalZ=this.originalY=this.originalX=this.ratioZ=this.ratioY=this.ratioX=null;if(typeof a!="undefined")this.vertex=a};a.VertexProxy.prototype.setVertex=function(){};a.VertexProxy.prototype.setRatios=function(a,b,c){this.ratioX=a;this.ratioY=b;this.ratioZ=c};a.VertexProxy.prototype.setOriginalPosition=function(a,b,c){this.originalX=a;this.originalY=b;this.originalZ=c};a.VertexProxy.prototype.getX=function(){};a.VertexProxy.prototype.getY=function(){};
a.VertexProxy.prototype.getZ=function(){};a.VertexProxy.prototype.setX=function(){};a.VertexProxy.prototype.setY=function(){};a.VertexProxy.prototype.setZ=function(){};a.VertexProxy.prototype.getValue=function(d){switch(d){case a.ModConstant.X:return this.getX();case a.ModConstant.Y:return this.getY();case a.ModConstant.Z:return this.getZ()}return 0};a.VertexProxy.prototype.setValue=function(d,b){switch(d){case a.ModConstant.X:this.setX(b);break;case a.ModConstant.Y:this.setY(b);break;case a.ModConstant.Z:this.setZ(b)}};
a.VertexProxy.prototype.getRatio=function(d){switch(d){case a.ModConstant.X:return this.ratioX;case a.ModConstant.Y:return this.ratioY;case a.ModConstant.Z:return this.ratioZ}return-1};a.VertexProxy.prototype.getOriginalValue=function(d){switch(d){case a.ModConstant.X:return this.originalX;case a.ModConstant.Y:return this.originalY;case a.ModConstant.Z:return this.originalZ}return 0};a.VertexProxy.prototype.reset=function(){this.setX(this.originalX);this.setY(this.originalY);this.setZ(this.originalZ)};
a.VertexProxy.prototype.collapse=function(){this.originalX=this.getX();this.originalY=this.getY();this.originalZ=this.getZ()};a.VertexProxy.prototype.getVector=function(){return new a.Vector3(this.getX(),this.getY(),this.getZ())};a.VertexProxy.prototype.setVector=function(a){this.setX(a.x);this.setY(a.y);this.setZ(a.z)};a.VertexProxy.prototype.getRatioVector=function(){return new a.Vector3(this.ratioX,this.ratioY,this.ratioZ)}})(MOD3);
(function(a){a.FaceProxy=function(){this.vertices=[]};a.FaceProxy.prototype.addVertex=function(a){this.vertices.push(a)};a.FaceProxy.prototype.getVertices=function(){return this.vertices}})(MOD3);
(function(a){a.MeshProxy=function(){this.depth=this.height=this.width=this.minAxis=this.midAxis=this.maxAxis=this.minZ=this.minY=this.minX=this.maxZ=this.maxY=this.maxX=this.faces=this.vertices=null;this.vertices=[];this.faces=[];this.mesh=null};a.MeshProxy.prototype.getVertices=function(){return this.vertices};a.MeshProxy.prototype.getFaces=function(){return this.faces};a.MeshProxy.prototype.analyzeGeometry=function(){var d=this.getVertices().length,b,c;for(b=0;b<d;b++)c=this.getVertices()[b],b==
0?(this.minX=this.maxX=c.getX(),this.minY=this.maxY=c.getY(),this.minZ=this.maxZ=c.getZ()):(this.minX=Math.min(this.minX,c.getX()),this.minY=Math.min(this.minY,c.getY()),this.minZ=Math.min(this.minZ,c.getZ()),this.maxX=Math.max(this.maxX,c.getX()),this.maxY=Math.max(this.maxY,c.getY()),this.maxZ=Math.max(this.maxZ,c.getZ())),c.setOriginalPosition(c.getX(),c.getY(),c.getZ());this.width=this.maxX-this.minX;this.height=this.maxY-this.minY;this.depth=this.maxZ-this.minZ;b=Math.max(this.width,Math.max(this.height,
this.depth));c=Math.min(this.width,Math.min(this.height,this.depth));if(b==this.width&&c==this.height)this.minAxis=a.ModConstant.Y,this.midAxis=a.ModConstant.Z,this.maxAxis=a.ModConstant.X;else if(b==this.width&&c==this.depth)this.minAxis=a.ModConstant.Z,this.midAxis=a.ModConstant.Y,this.maxAxis=a.ModConstant.X;else if(b==this.height&&c==this.width)this.minAxis=a.ModConstant.X,this.midAxis=a.ModConstant.Z,this.maxAxis=a.ModConstant.Y;else if(b==this.height&&c==this.depth)this.minAxis=a.ModConstant.Z,
this.midAxis=a.ModConstant.X,this.maxAxis=a.ModConstant.Y;else if(b==this.depth&&c==this.width)this.minAxis=a.ModConstant.X,this.midAxis=a.ModConstant.Y,this.maxAxis=a.ModConstant.Z;else if(b==this.depth&&c==this.height)this.minAxis=a.ModConstant.Y,this.midAxis=a.ModConstant.X,this.maxAxis=a.ModConstant.Z;for(b=0;b<d;b++)c=this.getVertices()[b],c.setRatios((c.getX()-this.minX)/this.width,(c.getY()-this.minY)/this.height,(c.getZ()-this.minZ)/this.depth)};a.MeshProxy.prototype.resetGeometry=function(){for(var a=
this.getVertices().length,b=0;b<a;b++)this.getVertices()[b].reset()};a.MeshProxy.prototype.collapseGeometry=function(){for(var a=this.getVertices().length,b=0;b<a;b++)this.getVertices()[b].collapse();this.analyzeGeometry()};a.MeshProxy.prototype.getMin=function(d){switch(d){case a.ModConstant.X:return this.minX;case a.ModConstant.Y:return this.minY;case a.ModConstant.Z:return this.minZ}return-1};a.MeshProxy.prototype.getMax=function(d){switch(d){case a.ModConstant.X:return this.maxX;case a.ModConstant.Y:return this.maxY;
case a.ModConstant.Z:return this.maxZ}return-1};a.MeshProxy.prototype.getSize=function(d){switch(d){case a.ModConstant.X:return this.width;case a.ModConstant.Y:return this.height;case a.ModConstant.Z:return this.depth}return-1};a.MeshProxy.prototype.setMesh=function(a){this.mesh=a;this.vertices=[];this.faces=[]};a.MeshProxy.prototype.postApply=function(){};a.MeshProxy.prototype.updateMeshPosition=function(){}})(MOD3);
(function(a){a.Modifier=function(){this.mod=null};a.Modifier.prototype.setModifiable=function(a){this.mod=a};a.Modifier.prototype.getVertices=function(){return this.mod.getVertices()};a.Modifier.prototype.apply=function(){}})(MOD3);(function(a){a.Library3d=function(){this.id="";this.vertexClass=this.meshClass=null}})(MOD3);(function(a){a.PluginFactory={};a.PluginFactory.getMeshProxy=function(a){return new a.meshClass}})(MOD3);
(function(a){a.ModifierStack=function(d,b){this.lib3d=d;this.stack=this.baseMesh=null;this.baseMesh=a.PluginFactory.getMeshProxy(d);this.baseMesh.setMesh(b);this.baseMesh.analyzeGeometry();this.stack=[]};a.ModifierStack.prototype.addModifier=function(a){a.setModifiable(this.baseMesh);this.stack.push(a)};a.ModifierStack.prototype.apply=function(){this.baseMesh.resetGeometry();for(var a=0;a<this.stack.length;a++)this.stack[a].apply();this.baseMesh.postApply()};a.ModifierStack.prototype.collapse=function(){this.apply();
this.baseMesh.collapseGeometry();this.stack=[]};a.ModifierStack.prototype.clear=function(){this.stack=[]};a.ModifierStack.prototype.getMeshInfo=function(){return this.baseMesh}})(MOD3);
(function(a){a.Pivot=function(d,b,c){this.pivot=null;this.pivot=new a.Vector3(d,b,c)};a.Pivot.prototype=new a.Modifier;a.Pivot.prototype.constructor=a.Pivot;a.Pivot.prototype.setMeshCenter=function(){this.pivot=new a.Vector3(-(this.mod.minX+this.mod.width/2),-(this.mod.minY+this.mod.height/2),-(this.mod.minZ+this.mod.depth/2))};a.Pivot.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var e=a[c],g=e.getVector().clone();e.setVector(g.add(this.pivot))}this.mod.updateMeshPosition(this.pivot.clone().negate())}})(MOD3);
(function(a){a.Bend=function(d,b,c){this.diagAngle=this.angle=this.offset=this.force=null;this.constraint=a.ModConstant.NONE;this.m2=this.m1=this.origin=this.height=this.width=this.mid=this.min=this.max=null;this.switchAxes=!1;this.force=d;this.offset=b;this.setAngle(c)};a.Bend.prototype=new a.Modifier;a.Bend.prototype.constructor=a.Bend;a.Bend.prototype.setAngle=function(d){this.angle=d;this.m1=new a.Matrix;this.m1.rotate(this.angle);this.m2=new a.Matrix;this.m2.rotate(-this.angle)};a.Bend.prototype.setModifiable=
function(d){a.Modifier.prototype.setModifiable.call(this,d);this.max=this.switchAxes?this.mod.midAxis:this.mod.maxAxis;this.min=this.mod.minAxis;this.mid=this.switchAxes?this.mod.maxAxis:this.mod.midAxis;this.width=this.mod.getSize(this.max);this.height=this.mod.getSize(this.mid);this.origin=this.mod.getMin(this.max);this.diagAngle=Math.atan(this.width/this.height)};a.Bend.prototype.apply=function(){if(this.force!=0)for(var d=this.mod.getVertices(),b=d.length,c=this.origin+this.width*this.offset,
e=this.width/Math.PI/this.force,g=Math.PI*2*(this.width/(e*Math.PI*2)),f=0;f<b;f++){var h=d[f],j=h.getValue(this.max),i=h.getValue(this.mid),l=h.getValue(this.min),i=this.m1.transformPoint(new a.Point(j,i)),j=i.x,i=i.y,k=(j-this.origin)/this.width;this.constraint==a.ModConstant.LEFT&&k<=this.offset||this.constraint==a.ModConstant.RIGHT&&k>=this.offset||(j=Math.PI/2-g*this.offset+g*k,k=Math.cos(j)*(e+l),l=Math.sin(j)*(e+l)-e,j=c-k);i=this.m2.transformPoint(new a.Point(j,i));j=i.x;i=i.y;h.setValue(this.max,
j);h.setValue(this.mid,i);h.setValue(this.min,l)}}})(MOD3);
(function(a){a.Bloat=function(){this.center=a.Vector3.ZERO();this.radius=0;this.a=0.01;this.u=a.Vector3.ZERO()};a.Bloat.prototype=new a.Modifier;a.Bloat.prototype.constructor=a.Bloat;a.Bloat.prototype.setRadius=function(a){this.radius=Math.max(0,a)};a.Bloat.prototype.setA=function(a){this.a=Math.max(0,a)};a.Bloat.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c,e=0;e<b;e++)c=a[e],this.u.x=c.getX()-this.center.x,this.u.y=c.getY()-this.center.y,this.u.z=c.getZ()-this.center.z,
this.u.setMagnitude(this.u.getMagnitude()+this.radius*Math.exp(-this.u.getMagnitude()*this.a)),c.setX(this.u.x+this.center.x),c.setY(this.u.y+this.center.y),c.setZ(this.u.z+this.center.z)}})(MOD3);
(function(a){a.Twist=function(d){this.vector=new a.Vector3(0,1,0);this.angle=d;this.center=a.Vector3.ZERO()};a.Twist.prototype=new a.Modifier;a.Twist.prototype.constructor=a.Twist;a.Twist.prototype.apply=function(){this.vector.normalize();for(var d=new a.Vector3(this.mod.maxX/2,this.mod.maxY/2,this.mod.maxZ/2),b=-a.Vector3.prototype.dot.call(this,this.vector,this.center),c=0;c<this.mod.getVertices().length;c++){var e=this.mod.getVertices()[c],g=a.Vector3.prototype.dot.call(this,new a.Vector3(e.getX(),
e.getY(),e.getZ()),this.vector)+b;this.twistPoint(e,g/d.getMagnitude()*this.angle)}};a.Twist.prototype.twistPoint=function(d,b){var c=(new a.Matrix4).translationMatrix(d.getX(),d.getY(),d.getZ()),c=(new a.Matrix4).multiply((new a.Matrix4).rotationMatrix(this.vector.x,this.vector.y,this.vector.z,b),c);d.setX(c.n14);d.setY(c.n24);d.setZ(c.n34)}})(MOD3);
(function(a){a.Skew=function(d){this.force=0;this.skewAxis=null;if(typeof d!="undefined")this.force=d;this.offset=0.5;this.constraint=a.ModConstant.NONE;this.falloff=this.power=1;this.swapAxes=this.oneSide=this.inverseFalloff=!1};a.Skew.prototype=new a.Modifier;a.Skew.prototype.constructor=a.Skew;a.Skew.prototype.setModifiable=function(d){a.Modifier.prototype.setModifiable.call(this,d);this.skewAxis=this.skewAxis||this.mod.maxAxis};a.Skew.prototype.apply=function(){for(var d=this.mod.getVertices(),
b=d.length,c=0;c<b;c++){var e=d[c];if(!(this.constraint==a.ModConstant.LEFT&&e.getRatio(this.skewAxis)<=this.offset)&&!(this.constraint==a.ModConstant.RIGHT&&e.getRatio(this.skewAxis)>this.offset)){var g=e.getRatio(this.skewAxis)-this.offset;this.oneSide&&(g=Math.abs(g));var f=e.getRatio(this.getDisplaceAxis());this.inverseFalloff&&(f=1-f);f=this.falloff+f*(1-this.falloff);g=Math.pow(Math.abs(g),this.power)*a.XMath.sign(g,1);g=e.getValue(this.getDisplaceAxis())+this.force*g*f;e.setValue(this.getDisplaceAxis(),
g)}}};a.Skew.prototype.getDisplaceAxis=function(){switch(this.skewAxis){case a.ModConstant.X:return this.swapAxes?a.ModConstant.Z:a.ModConstant.Y;case a.ModConstant.Y:return this.swapAxes?a.ModConstant.Z:a.ModConstant.X;case a.ModConstant.Z:return this.swapAxes?a.ModConstant.Y:a.ModConstant.X;default:return 0}}})(MOD3);
(function(a){a.Taper=function(d){this.power=this.force=null;this.start=0;this.end=1;this.vector=new a.Vector3(1,0,1);this.vector2=new a.Vector3(0,1,0);if(typeof d!="undefined")this.force=d;this.power=1};a.Taper.prototype=new a.Modifier;a.Taper.prototype.constructor=a.Taper;a.Taper.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Taper.prototype.apply=function(){for(var d=this.mod.getVertices(),b=d.length,c=0;c<
b;c++){var e=d[c],g=e.getRatioVector().multiply(this.vector2),g=this.force*Math.pow(g.getMagnitude(),this.power),g=(new a.Matrix4).scaleMatrix(1+g*this.vector.x,1+g*this.vector.y,1+g*this.vector.z),f=e.getVector();(new a.Matrix4).multiplyVector(g,f);e.setVector(f)}}})(MOD3);
(function(a){a.Wheel=function(){this.radius=this.roll=this.turn=this.speed=null;this.steerVector=new a.Vector3(0,1,0);this.rollVector=new a.Vector3(0,0,1);this.roll=this.turn=this.speed=0};a.Wheel.prototype=new a.Modifier;a.Wheel.prototype.constructor=a.Wheel;a.Wheel.prototype.setModifiable=function(d){a.Modifier.prototype.setModifiable.call(this,d);this.radius=this.mod.width/2};a.Wheel.prototype.apply=function(){this.roll+=this.speed;var d=this.mod.getVertices(),b=d.length,c;if(this.turn!=0){var e=
(new a.Matrix4).rotationMatrix(this.steerVector.x,this.steerVector.y,this.steerVector.z,this.turn);c=this.rollVector.clone();(new a.Matrix4).multiplyVector(e,c);c=(new a.Matrix4).rotationMatrix(c.x,c.y,c.z,this.roll)}else c=(new a.Matrix4).rotationMatrix(this.rollVector.x,this.rollVector.y,this.rollVector.z,this.roll);for(var g=0;g<b;g++){var f=d[g],h=f.getVector().clone();this.turn!=0&&(new a.Matrix4).multiplyVector(e,h);(new a.Matrix4).multiplyVector(c,h);f.setX(h.x);f.setY(h.y);f.setZ(h.z)}};a.Wheel.prototype.getStep=
function(){return this.radius*this.speed/Math.PI};a.Wheel.prototype.getPerimeter=function(){return this.radius*2*Math.PI}})(MOD3);
(function(a){a.Break=function(d,b){this.bv=new a.Vector3(0,1,0);this.angle=this.offset=0;if(typeof d!="undefined")this.offset=d;if(typeof b!="undefined")this.angle=b;this.range=new a.Range(0,1)};a.Break.prototype=new a.Modifier;a.Break.prototype.constructor=a.Break;a.Break.prototype.apply=function(){for(var d=this.mod.getVertices(),b=d.length,c=new a.Vector3(0,0,-(this.mod.minZ+this.mod.depth*this.offset)),e=0;e<b;e++){var g=d[e],f=g.getVector(),f=f.add(c);if(f.z>=0&&this.range.isIn(g.ratioY)){var h=
this.angle,h=(new a.Matrix4).rotationMatrix(this.bv.x,this.bv.y,this.bv.z,h);(new a.Matrix4).multiplyVector(h,f)}h=c.negate();f=f.add(h);g.setX(f.x);g.setY(f.y);g.setZ(f.z)}}})(MOD3);
(function(a){a.Noise=function(d){this.force=0;this.axc=a.ModConstant.NONE;this.end=this.start=0;if(typeof d!="undefined")this.force=d};a.Noise.prototype=new a.Modifier;a.Noise.prototype.constructor=a.Noise;a.Noise.prototype.constraintAxes=function(a){this.axc=a};a.Noise.prototype.setFalloff=function(a,b){this.start=0;this.end=1;if(typeof a!="undefined")this.start=a;if(typeof b!="undefined")this.end=b};a.Noise.prototype.apply=function(){for(var a=this.mod.getVertices(),b=a.length,c=0;c<b;c++){var e=
a[c],g=Math.random()*this.force-this.force/2,f=e.getRatio(this.mod.maxAxis);this.start<this.end?(f<this.start&&(f=0),f>this.end&&(f=1)):this.start>this.end?(f=1-f,f>this.start&&(f=0),f<this.end&&(f=1)):f=1;this.axc&1||e.setX(e.getX()+g*f);this.axc>>1&1||e.setY(e.getY()+g*f);this.axc>>2&1||e.setZ(e.getZ()+g*f)}}})(MOD3);
(function(a){a.LibraryThree=function(){this.id="Three.js";this.meshClass=a.MeshThree;this.vertexClass=a.VertexThree};a.LibraryThree.prototype=new a.Library3d;a.LibraryThree.prototype.constructor=a.LibraryThree})(MOD3);
(function(a){a.VertexThree=function(a){this.mesh=a};a.VertexThree.prototype=new a.VertexProxy;a.VertexThree.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.x;this.originalY=a.y;this.originalZ=a.z};a.VertexThree.prototype.getX=function(){return this.vertex.x};a.VertexThree.prototype.getY=function(){return this.vertex.y};a.VertexThree.prototype.getZ=function(){return this.vertex.z};a.VertexThree.prototype.setX=function(a){this.vertex.x=a;this.mesh.geometry.verticesNeedUpdate=!0;this.mesh.geometry.normalsNeedUpdate=
!0;this.mesh.geometry.buffersNeedUpdate=!0;this.mesh.geometry.dynamic=!0};a.VertexThree.prototype.setY=function(a){this.vertex.y=a;this.mesh.geometry.verticesNeedUpdate=!0;this.mesh.geometry.normalsNeedUpdate=!0;this.mesh.geometry.buffersNeedUpdate=!0;this.mesh.geometry.dynamic=!0};a.VertexThree.prototype.setZ=function(a){this.vertex.z=a;this.mesh.geometry.verticesNeedUpdate=!0;this.mesh.geometry.normalsNeedUpdate=!0;this.mesh.geometry.buffersNeedUpdate=!0;this.mesh.geometry.dynamic=!0}})(MOD3);
(function(a){a.MeshThree=function(){};a.MeshThree.prototype=new a.MeshProxy;a.MeshThree.prototype.setMesh=function(d){a.MeshProxy.prototype.setMesh.call(this,d);for(var d=[],b=this.mesh.geometry.vertices,c=this.mesh.geometry.faces,e=b.length,g=c.length,f=0;f<e;f++){var h=new a.VertexThree(this.mesh);h.setVertex(b[f]);this.vertices.push(h);d[b[f]]=h}for(f=0;f<g;f++)e=new a.FaceProxy,c[f]instanceof THREE.Face3?(e.addVertex(d[b[c[f].a]]),e.addVertex(d[b[c[f].b]]),e.addVertex(d[b[c[f].c]])):c[f]instanceof
THREE.Face4&&(e.addVertex(d[b[c[f].a]]),e.addVertex(d[b[c[f].b]]),e.addVertex(d[b[c[f].c]]),e.addVertex(d[b[c[f].d]])),this.faces.push(e);delete lookup};a.MeshThree.prototype.updateMeshPosition=function(a){this.mesh.position.x+=a.x;this.mesh.position.y+=a.y;this.mesh.position.z+=a.z}})(MOD3);(function(a){a.LibraryPre3D=function(){this.id="pre3d.js";this.meshClass=a.MeshPre3D;this.vertexClass=a.VertexPre3D};a.LibraryThree.prototype=new a.Library3d;a.LibraryThree.prototype.constructor=a.LibraryPre3D})(MOD3);
(function(a){a.VertexPre3D=function(){};a.VertexPre3D.prototype=new a.VertexProxy;a.VertexPre3D.prototype.setVertex=function(a){this.vertex=a;this.originalX=a.x;this.originalY=a.y;this.originalZ=a.z};a.VertexPre3D.prototype.getX=function(){return this.vertex.x};a.VertexPre3D.prototype.getY=function(){return this.vertex.y};a.VertexPre3D.prototype.getZ=function(){return this.vertex.z};a.VertexPre3D.prototype.setX=function(a){this.vertex.x=a};a.VertexPre3D.prototype.setY=function(a){this.vertex.y=a};
a.VertexPre3D.prototype.setZ=function(a){this.vertex.z=a}})(MOD3);
(function(a){a.MeshPre3D=function(){};a.MeshPre3D.prototype=new a.MeshProxy;a.MeshPre3D.prototype.setMesh=function(d){a.MeshProxy.prototype.setMesh.call(this,d);for(var d=[],b=this.mesh.vertices,c=this.mesh.quads,e=b.length,g=c.length,f=0;f<e;f++){var h=new a.VertexPre3D;h.setVertex(b[f]);this.vertices.push(h);d[b[f]]=h}for(f=0;f<g;f++)e=new a.FaceProxy,c[f]instanceof Pre3d.QuadFace&&(e.addVertex(d[b[c[f].i0]]),e.addVertex(d[b[c[f].i1]]),e.addVertex(d[b[c[f].i2]]),c[f].i3!=null&&e.addVertex(d[b[c[f].i3]])),
this.faces.push(e);delete lookup};a.MeshPre3D.prototype.updateMeshPosition=function(){}})(MOD3);(function(a){a.LibraryJ3D=function(){this.id="J3D";this.meshClass=a.MeshJ3D;this.vertexClass=a.VertexJ3D};a.LibraryJ3D.prototype=new a.Library3d;a.LibraryJ3D.prototype.constructor=a.LibraryJ3D})(MOD3);
(function(a){a.VertexJ3D=function(a){this.geometry=a};a.VertexJ3D.prototype=new a.VertexProxy;a.VertexJ3D.prototype.setVertex=function(a){this.vertex=a;this.originalX=this.geometry.vertexPositionBuffer.data[this.vertex];this.originalY=this.geometry.vertexPositionBuffer.data[this.vertex+1];this.originalZ=this.geometry.vertexPositionBuffer.data[this.vertex+2]};a.VertexJ3D.prototype.getX=function(){return this.geometry.vertexPositionBuffer.data[this.vertex]};a.VertexJ3D.prototype.getY=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+
1]};a.VertexJ3D.prototype.getZ=function(){return this.geometry.vertexPositionBuffer.data[this.vertex+2]};a.VertexJ3D.prototype.setX=function(a){this.geometry.vertexPositionBuffer.data[this.vertex]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)};a.VertexJ3D.prototype.setY=function(a){this.geometry.vertexPositionBuffer.data[this.vertex+1]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)};
a.VertexJ3D.prototype.setZ=function(a){this.geometry.vertexPositionBuffer.data[this.vertex+2]=a;this.geometry.replaceArray(this.geometry.vertexPositionBuffer,this.geometry.vertexPositionBuffer.data)}})(MOD3);
(function(a){a.MeshJ3D=function(){};a.MeshJ3D.prototype=new a.MeshProxy;a.MeshJ3D.prototype.setMesh=function(d){a.MeshProxy.prototype.setMesh.call(this,d);for(var d=this.mesh.geometry.vertexPositionBuffer.itemSize,b=this.mesh.geometry.vertexPositionBuffer.data.length,c=0;c<b;c+=d){var e=new a.VertexJ3D(this.mesh.geometry);e.setVertex(c);this.vertices.push(e)}this.faces=null;delete lookup};a.MeshJ3D.prototype.updateMeshPosition=function(a){this.mesh.position.x+=a.x;this.mesh.position.y+=a.y;this.mesh.position.z+=
a.z}})(MOD3);(function(a){a.LibraryCopperlicht=function(){this.id="Copperlicht";this.meshClass=a.MeshCopperlicht;this.vertexClass=a.VertexCopperlicht};a.LibraryCopperlicht.prototype=new a.Library3d;a.LibraryCopperlicht.prototype.constructor=a.LibraryCopperlicht})(MOD3);
(function(a){a.VertexCopperlicht=function(a,b){this.node=a;this.buffer=b};a.VertexCopperlicht.prototype=new a.VertexProxy;a.VertexCopperlicht.prototype.setVertex=function(a){this.vertex=a;this.originalX=this.vertex.Pos.X;this.originalY=this.vertex.Pos.Y;this.originalZ=this.vertex.Pos.Z};a.VertexCopperlicht.prototype.getX=function(){return this.vertex.Pos.X};a.VertexCopperlicht.prototype.getY=function(){return this.vertex.Pos.Y};a.VertexCopperlicht.prototype.getZ=function(){return this.vertex.Pos.Z};
a.VertexCopperlicht.prototype.setX=function(a){this.vertex.Pos.X=a;this.buffer.update(!0)};a.VertexCopperlicht.prototype.setY=function(a){this.vertex.Pos.Y=a;this.buffer.update(!0)};a.VertexCopperlicht.prototype.setZ=function(a){this.vertex.Pos.Z=a;this.buffer.update(!0)}})(MOD3);
(function(a){a.MeshCopperlicht=function(){};a.MeshCopperlicht.prototype=new a.MeshProxy;a.MeshCopperlicht.prototype.setMesh=function(d){a.MeshProxy.prototype.setMesh.call(this,d);for(var d=this.mesh.getMesh().GetMeshBuffers(),b=[],c=0;c<d.length;c++)for(var b=d[c].Vertices,e=b.length,g=0;g<e;g++){var f=new a.VertexCopperlicht(this.mesh,d[c]);f.setVertex(b[g]);this.vertices.push(f)}this.faces=null;delete lookup};a.MeshCopperlicht.prototype.updateMeshPosition=function(a){this.mesh.Pos.X+=a.x;this.mesh.Pos.Y+=
a.y;this.mesh.Pos.Z+=a.z}})(MOD3);
